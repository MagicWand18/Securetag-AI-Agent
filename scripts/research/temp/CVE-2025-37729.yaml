rules:
  - id: synthetic-cve202537729
    languages:
      - javascript
      - typescript
    severity: ERROR
    message: >
      Posible explotación similar a CVE-2025-37729: se está renderizando una plantilla
      controlada por el usuario mediante Jinjava (u otro motor de plantillas similar)
      con un contexto amplio que incluye datos sensibles o funciones privilegiadas.
      Un atacante con capacidad de enviar la plantilla puede leer secretos (por ejemplo
      claves API, tokens) o invocar funciones administrativas (por ejemplo ece.runAdminCommand),
      lo que puede derivar en fuga de información y ejecución de acciones críticas.
    metadata:
      cwe: "CWE-94: Improper Control of Generation of Code ('Code Injection')"
      owasp: "A03:2021 - Injection"
      category: "security"
      technology:
        - javascript
        - typescript
        - nodejs
      likelihood: "HIGH"
      impact: "HIGH"
      confidence: "MEDIUM"
      references:
        - "https://nvd.nist.gov/vuln/detail/CVE-2025-37729"
    patterns:
      - pattern-inside: |
          const $JINJAVA = new Jinjava(...);
          ...
      - pattern-either:
          # Caso async/await
          - pattern: |
              const $RES = await $JINJAVA.render($TEMPLATE, $CONTEXT);
          # Caso síncrono
          - pattern: |
              const $RES = $JINJAVA.render($TEMPLATE, $CONTEXT);
      - pattern-inside: |
          app.$METHOD($ROUTE, ($REQ, $RES, ...$REST) => {
            ...
          })
      - pattern-not: |
          const $RES = await $JINJAVA.render($TEMPLATE, {});
      - pattern-not: |
          const $RES = $JINJAVA.render($TEMPLATE, {});