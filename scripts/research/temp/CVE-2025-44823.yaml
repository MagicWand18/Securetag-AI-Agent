rules:
  - id: synthetic-cve202544823
    languages:
      - javascript
      - typescript
    message: >
      Posible exposición de API keys en texto claro a través de un endpoint que devuelve
      la lista completa de usuarios sin filtrado de campos sensibles ni control de acceso
      robusto. Este patrón es conceptualmente similar a CVE-2025-44823 en Nagios Log Server,
      donde un endpoint `/api/system/get_users` permitía a cualquier usuario con un token
      válido obtener usuarios y sus API keys en texto claro, posibilitando enumeración de
      cuentas, escalada de privilegios y compromiso total del sistema.
    severity: ERROR
    metadata:
      cwe: "CWE-200: Exposure of Sensitive Information to an Unauthorized Actor"
      owasp: "A01:2021 - Broken Access Control"
      category: security
      technology:
        - javascript
        - typescript
        - nodejs
      likelihood: HIGH
      impact: HIGH
      confidence: MEDIUM
      references:
        - "https://nvd.nist.gov/vuln/detail/CVE-2025-44823"
    patterns:
      # 1) Definición de una colección de usuarios en memoria (o similar) con un campo tipo API key
      - pattern-inside: |
          const $USERS = [
            ...
            {
              ...,
              $APIKEY_FIELD: $APIKEY_VALUE,
              ...
            },
            ...
          ];
      # 2) El nombre del campo sugiere que es una API key o token sensible
      - metavariable-regex:
          metavariable: $APIKEY_FIELD
          regex: '(?i)(api[_-]?key|apikey|token|access[_-]?token|secret)'
      # 3) Un endpoint Express que devuelve directamente esa colección de usuarios como JSON
      - pattern: |
          $APP.$METHOD($ROUTE, ...$MIDDLEWARES, ($REQ, $RES, ...$REST) => {
            ...
            $RES.json($USERS);
            ...
          })