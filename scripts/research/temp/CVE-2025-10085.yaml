rules:
  - id: synthetic-cve202510085
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible vulnerabilidad de subida de archivos sin validación en un directorio
      público (CVE-2025-10085). El archivo subido se guarda directamente en una
      ruta accesible desde la web sin comprobar tipo, extensión ni tamaño, lo que
      permite a un atacante subir contenido malicioso (por ejemplo, scripts o
      archivos ejecutables) y acceder a ellos mediante una URL pública.
    metadata:
      cve: "CVE-2025-10085"
      source: "CISA_KEV"
      category: "insecure-file-upload"
      likelihood: "high"
      impact: "high"
      references:
        - "https://nvd.nist.gov/vuln/detail/CVE-2025-10085"
    patterns:
      - pattern-either:
          # Caso típico con express-fileupload: req.files.<algo>.mv(...)
          - pattern: |
              $APP.$METHOD($ROUTE, ... , (req, res, ... ) => {
                ...
                if (!req.files || !req.files.$F) {
                  ...
                }
                ...
                const $UPLOADED = req.files.$F;
                ...
                const $UPLOAD_DIR = $PATH.join(..., 'public', ...);
                ...
                const $UPLOAD_PATH = $PATH.join($UPLOAD_DIR, $UPLOADED.name);
                ...
                $UPLOADED.mv($UPLOAD_PATH, ...);
                ...
                res.$SEND(`File uploaded successfully: ${$PUBLIC_URL}`);
              })
          # Variante sin la comprobación explícita de req.files.$F
          - pattern: |
              $APP.$METHOD($ROUTE, ... , (req, res, ... ) => {
                ...
                const $UPLOADED = req.files.$F;
                ...
                const $UPLOAD_DIR = $PATH.join(..., 'public', ...);
                ...
                const $UPLOAD_PATH = $PATH.join($UPLOAD_DIR, $UPLOADED.name);
                ...
                $UPLOADED.mv($UPLOAD_PATH, ...);
                ...
                res.$SEND($RESP);
              })
    fix: >
      Valida estrictamente el tipo MIME, extensión y tamaño del archivo antes de
      guardarlo, utiliza listas blancas de extensiones permitidas y evita
      almacenar archivos subidos directamente en directorios servidos
      públicamente. En su lugar, usa rutas no públicas y genera nombres de
      archivo seguros.