rules:
  - id: synthetic-cve202327524
    languages:
      - javascript
      - typescript
    message: >
      Uso de una clave secreta de sesión hardcodeada y estática en express-session.
      Si la clave es conocida, predecible o compartida (como en ejemplos por defecto),
      un atacante puede forjar cookies de sesión válidas y secuestrar sesiones de otros
      usuarios, lo que se alinea con el riesgo descrito en CVE-2023-27524 (alta
      probabilidad de explotación). Utiliza una clave secreta fuerte, única y gestionada
      de forma segura (por ejemplo, mediante variables de entorno o un gestor de secretos).
    severity: ERROR
    metadata:
      cve: "CVE-2023-27524"
      source: "CISA_KEV"
      category: security
      technology:
        - express
        - express-session
      likelihood: HIGH
      impact: HIGH
    patterns:
      - pattern-either:
          # Caso 1: literal directamente en la opción `secret`
          - pattern: |
              app.use(session({
                ...,
                secret: "$SECRET",
                ...,
              }));
          # Caso 2: variable constante usada como `secret`
          - pattern: |
              const $CONST = $VAL;
              ...
              app.use(session({
                ...,
                secret: $CONST,
                ...,
              }));
      # Excluir casos donde la clave provenga claramente de variables de entorno
      # u orígenes dinámicos típicamente seguros.
      - pattern-not: |
          app.use(session({
            ...,
            secret: process.env.$ENV,
            ...,
          }));
      - pattern-not: |
          const $CONST = process.env.$ENV;
          ...
          app.use(session({
            ...,
            secret: $CONST,
            ...,
          }));
      - pattern-not: |
          let $CONST = process.env.$ENV;
          ...
          app.use(session({
            ...,
            secret: $CONST,
            ...,
          }));
      - pattern-not: |
          var $CONST = process.env.$ENV;
          ...
          app.use(session({
            ...,
            secret: $CONST,
            ...,
          }));