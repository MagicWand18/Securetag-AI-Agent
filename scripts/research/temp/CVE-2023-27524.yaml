rules:
  - id: synthetic-cve202327524
    languages:
      - javascript
      - typescript
    severity: ERROR
    message: >
      Uso de una clave secreta de sesión hardcodeada y estática en el servidor.
      Esto puede permitir a un atacante que conozca o adivine este valor falsificar
      cookies de sesión y autenticarse como otros usuarios, de forma similar a lo
      descrito en CVE-2023-27524 (caso Apache Superset, donde se reutilizaba una
      SECRET_KEY por defecto en múltiples instalaciones). Asegúrate de que la
      clave de sesión se genere de forma segura, no sea un valor por defecto
      conocido públicamente y no esté hardcodeada en el código fuente.
    patterns:
      - pattern-inside: |
          $APP.use($SESSION({
            ...,
            secret: $SECRET,
            ...
          }));
      - pattern-either:
          # Cadena literal directamente en la opción secret
          - pattern: |
              $APP.use($SESSION({
                ...,
                secret: "$LITERAL",
                ...
              }));
          # Variable constante usada como secret, definida como string literal
          - patterns:
              - pattern: |
                  const $SECRET = "$LITERAL";
              - pattern: |
                  $APP.use($SESSION({
                    ...,
                    secret: $SECRET,
                    ...
                  }));
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      category: "security"
      technology:
        - javascript
        - typescript
        - nodejs
      likelihood: "HIGH"
      impact: "HIGH"
      confidence: "MEDIUM"
      references:
        - "https://nvd.nist.gov/vuln/detail/CVE-2023-27524"