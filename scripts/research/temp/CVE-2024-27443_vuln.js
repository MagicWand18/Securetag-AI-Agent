const express = require('express');
const app = express();

app.use(express.urlencoded({ extended: true }));
app.use(express.json());

// Simulación muy simplificada de procesamiento de invitaciones de calendario
// "CalendarInvite" en una interfaz web clásica

// Endpoint que recibe una invitación de calendario (por ejemplo, desde un correo)
app.post('/calendar/invite', (req, res) => {
  // En un escenario real, estos datos vendrían parseados de un correo con cabeceras de calendario
  const {
    organizer,
    subject,
    location,
    description,
    startTime,
    endTime
  } = req.body;

  // VULNERABILIDAD XSS:
  // Se inserta directamente contenido controlado por el atacante en HTML sin escape
  // Un atacante puede enviar, por ejemplo, un "subject" con: <img src=x onerror="alert('XSS')">

  const html = `
    <html>
      <head><title>Invitación de Calendario</title></head>
      <body>
        <h1>Invitación de Calendario</h1>
        <div>
          <strong>Organizador:</strong> ${organizer}<br>
          <strong>Asunto:</strong> ${subject}<br>
          <strong>Ubicación:</strong> ${location}<br>
          <strong>Inicio:</strong> ${startTime}<br>
          <strong>Fin:</strong> ${endTime}<br>
        </div>
        <hr>
        <div>
          <strong>Descripción:</strong><br>
          <div>${description}</div>
        </div>
      </body>
    </html>
  `;

  res.setHeader('Content-Type', 'text/html; charset=utf-8');
  res.send(html);
});

app.listen(3000, () => {
  console.log('Servidor vulnerable de invitaciones de calendario escuchando en http://localhost:3000');
});
