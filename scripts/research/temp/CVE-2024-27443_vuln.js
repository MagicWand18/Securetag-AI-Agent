const express = require('express');
const app = express();

// Simula el renderizado de una invitación de calendario en una UI webmail clásica.
// VULNERABLE: inserta cabeceras/propiedades del "invite" directamente en HTML.
app.get('/calendar/invite', (req, res) => {
  // En un caso real, esto vendría de un email (p.ej. cabeceras iCalendar/CalendarInvite)
  // Aquí lo simulamos con un query param controlado por el atacante.
  const calendarHeader = req.query.calendarHeader || 'Meeting';

  // XSS: el atacante puede inyectar HTML/JS en calendarHeader
  // Ejemplo: ?calendarHeader=<img src=x onerror=alert(document.domain)>
  const html = `
    <html>
      <body>
        <h2>Calendar Invite</h2>
        <div><b>Subject:</b> ${calendarHeader}</div>
      </body>
    </html>
  `;

  res.set('Content-Type', 'text/html; charset=utf-8');
  res.send(html);
});

app.listen(3000, () => console.log('Listening on http://localhost:3000'));
