const express = require('express');
const escapeHtml = require('escape-html');
const app = express();

// Versión segura: codifica/escapa cualquier dato no confiable antes de insertarlo en HTML.
app.get('/calendar/invite', (req, res) => {
  const calendarHeader = req.query.calendarHeader || 'Meeting';

  // Mitigación XSS: escape de caracteres especiales HTML
  const safeHeader = escapeHtml(calendarHeader);

  const html = `
    <html>
      <body>
        <h2>Calendar Invite</h2>
        <div><b>Subject:</b> ${safeHeader}</div>
      </body>
    </html>
  `;

  res.set('Content-Type', 'text/html; charset=utf-8');
  res.send(html);
});

app.listen(3000, () => console.log('Listening on http://localhost:3000'));
