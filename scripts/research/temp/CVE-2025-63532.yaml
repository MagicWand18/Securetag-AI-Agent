rules:
  - id: synthetic-cve202563532
    languages:
      - javascript
      - typescript
    severity: ERROR
    message: >
      Posible inyección SQL (CVE-2025-63532): se concatena directamente un parámetro
      controlado por el usuario en una consulta SQL (por ejemplo, req.query.reqid en
      un UPDATE/DELETE/SELECT). En el Blood Bank Management System (cancel.php?reqid=7),
      este patrón permitió a un atacante inyectar código SQL (p.ej. "7 OR 1=1;--") y
      obtener acceso no autorizado a la base de datos. Usa consultas preparadas o
      parámetros enlazados en lugar de concatenar valores.
    patterns:
      - pattern-inside: |
          $DB = require('mysql2');
          ...
      - pattern-inside: |
          $CONN = $DB.$METHOD(...);
          ...
      - pattern-either:
          - pattern: |
              $CONN.query(`... WHERE ... = ${$USER_INPUT} ...`, ...);
          - pattern: |
              $CONN.query("... WHERE ... = " + $USER_INPUT, ...);
          - pattern: |
              $SQL = `... WHERE ... = ${$USER_INPUT} ...`;
              ...
              $CONN.query($SQL, ...);
          - pattern: |
              $SQL = "..." + $USER_INPUT + "...";
              ...
              $CONN.query($SQL, ...);
      - pattern-either:
          - pattern-inside: |
              app.get($ROUTE, ($REQ, $RES, ...) => {
                ...
              });
          - pattern-inside: |
              app.post($ROUTE, ($REQ, $RES, ...) => {
                ...
              });
      - pattern-either:
          - pattern-inside: |
              ... = $REQ.query.$PARAM;
              ...
          - pattern-inside: |
              ... = $REQ.params.$PARAM;
              ...
          - pattern-inside: |
              ... = $REQ.body.$PARAM;
              ...
    metadata:
      cwe: "CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')"
      owasp: "A03:2021 - Injection"
      category: "security"
      technology:
        - javascript
        - typescript
        - nodejs
      likelihood: "HIGH"
      impact: "HIGH"
      confidence: "MEDIUM"
      references:
        - "https://nvd.nist.gov/vuln/detail/CVE-2025-63532"