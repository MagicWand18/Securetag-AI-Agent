rules:
  - id: synthetic-cve201815811
    languages: [javascript, typescript]
    message: >
      Uso de cifrado simétrico débil (por ejemplo DES/3DES) con clave estática
      para proteger parámetros de entrada. Esto puede permitir a un atacante
      predecir, descifrar o forjar tokens, similar a la debilidad de cifrado
      inadecuado descrita en CVE-2018-15811, con alta probabilidad de
      explotación (91.8% según contexto de inteligencia de amenazas). Utiliza
      algoritmos modernos (AES-GCM/ChaCha20-Poly1305), claves aleatorias y
      gestión segura de IV/nonce.
    severity: ERROR
    metadata:
      cve: "CVE-2018-15811"
      source: "CISA_KEV"
      category: security
      technology: [nodejs, express]
      cwe: "CWE-327"
    patterns:
      - pattern-either:
          # createCipheriv con algoritmo débil
          - pattern: |
              $C = require('crypto');
              ...
              $X = $C.createCipheriv($ALGO, $KEY, $IV);
          - pattern: |
              import $C from 'crypto';
              ...
              $X = $C.createCipheriv($ALGO, $KEY, $IV);
          - pattern: |
              const $C = require('crypto');
              ...
              $X = $C.createCipheriv($ALGO, $KEY, $IV);
          - pattern: |
              import * as $C from 'crypto';
              ...
              $X = $C.createCipheriv($ALGO, $KEY, $IV);
      - pattern-inside: |
          ...
          const $WEAK_ALGO = $VAL;
          ...
      - metavariable-regex:
          metavariable: $VAL
          regex: (?i).*\b(des|3des|des-ede3|des-ede3-cbc|des-cbc)\b.*
      - pattern-not: |
          // safe
          ...