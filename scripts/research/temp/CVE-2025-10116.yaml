rules:
  - id: synthetic-cve202510116
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible vulnerabilidad de subida de archivos sin restricciones asociada a CVE-2025-10116:
      se mueve un archivo proporcionado por el usuario (`req.files.*`) a una ruta construida
      con `path.join` usando directamente `file.name` sin validación de tipo, extensión o tamaño.
      Un atacante puede subir scripts ejecutables u otros archivos peligrosos a un directorio
      accesible por el servidor, lo que puede conducir a ejecución remota de código o toma de
      control del sistema. Valida el tipo de archivo, restringe extensiones, limita tamaño y
      no uses el nombre original del archivo directamente.
    metadata:
      cve: "CVE-2025-10116"
      source: "CISA_KEV"
      category: "security"
      technology: ["nodejs", "express"]
      vulnerability_class: ["Unrestricted File Upload", "RCE"]
    patterns:
      - pattern-inside: |
          app.$METHOD($ROUTE, ($REQ, $RES) => {
            ...
          })
      - pattern-either:
          - pattern: |
              const $FILE = $REQ.files.$ANY;
              ...
              const $UPLOAD_PATH = path.join($UPLOAD_DIR, $FILE.name);
              ...
              $FILE.mv($UPLOAD_PATH, ...);
          - pattern: |
              let $FILE = $REQ.files.$ANY;
              ...
              let $UPLOAD_PATH = path.join($UPLOAD_DIR, $FILE.name);
              ...
              $FILE.mv($UPLOAD_PATH, ...);
          - pattern: |
              var $FILE = $REQ.files.$ANY;
              ...
              var $UPLOAD_PATH = path.join($UPLOAD_DIR, $FILE.name);
              ...
              $FILE.mv($UPLOAD_PATH, ...);
    fix: >
      No uses directamente `file.name` ni aceptes cualquier archivo sin validación. Genera un
      nombre seguro (por ejemplo, UUID), valida el tipo MIME y la extensión contra una lista
      blanca, y aplica límites de tamaño antes de mover el archivo.