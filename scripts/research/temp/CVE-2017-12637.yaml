rules:
  - id: synthetic-cve201712637
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible vulnerabilidad de directory traversal similar a CVE-2017-12637:
      se construye una ruta de archivo a partir de un par치metro de entrada
      (por ejemplo, query ?file=../../etc/passwd) y se pasa directamente a
      funciones de lectura de archivos sin validaci칩n ni normalizaci칩n
      estricta. Un atacante puede escapar del directorio previsto y leer
      archivos arbitrarios del sistema. Revise y valide/limite estrictamente
      los valores de los par치metros usados para construir rutas de archivos.
    metadata:
      cve: "CVE-2017-12637"
      source: "CISA_KEV"
      category: "security"
      technology: ["nodejs", "javascript", "typescript"]
      likelihood: "high"
      impact: "high"
      vulnerability_class: ["Path Traversal", "Directory Traversal"]
    patterns:
      - pattern-inside: |
          $SERVER = $HTTP.createServer(($REQ, $RES) => {
            ...
          });
      - pattern-either:
          - pattern: |
              $PARSED = $URL.parse($REQ.$URL, true);
              ...
              $FILE = $PARSED.$QUERY.$PARAM || $DFLT;
              ...
              $PATH = $PATHMOD.join($BASE, $FILE);
              ...
              $FS.readFile($PATH, ...);
          - pattern: |
              $PARSED = $URL.parse($REQ.$URL, true);
              ...
              $FILE = $PARSED.$QUERY.$PARAM;
              ...
              $PATH = $PATHMOD.join($BASE, $FILE);
              ...
              $FS.readFile($PATH, ...);
          - pattern: |
              $PARSED = $URL.parse($REQ.$URL, true);
              ...
              $FILE = $PARSED.$QUERY.$PARAM || $DFLT;
              ...
              $PATH = $PATHMOD.join($BASE, $FILE);
              ...
              $FS.readFileSync($PATH, ...);
          - pattern: |
              $PARSED = $URL.parse($REQ.$URL, true);
              ...
              $FILE = $PARSED.$QUERY.$PARAM;
              ...
              $PATH = $PATHMOD.join($BASE, $FILE);
              ...
              $FS.readFileSync($PATH, ...);
    metavariables:
      - metavariable: $HTTP
        pattern: require('http')
      - metavariable: $URL
        pattern: require('url')
      - metavariable: $FS
        pattern: require('fs')
      - metavariable: $PATHMOD
        pattern: require('path')