rules:
  - id: synthetic-cve202013927
    languages: [javascript, typescript]
    message: >
      Esta ruta HTTP expone una API "experimental" de orquestación de tareas sin
      ningún tipo de autenticación o autorización, lo que permite a un atacante
      remoto listar, disparar o modificar tareas de forma no autenticada.
      Esto es análogo a CVE-2020-13927 (Apache Airflow Experimental REST API
      expuesta sin autenticación), que ha mostrado alta probabilidad de
      explotación en entornos reales. Asegúrate de proteger estos endpoints con
      autenticación/autorización robusta o deshabilitarlos en producción.
    severity: ERROR
    metadata:
      cve: CVE-2020-13927
      source: CISA_KEV
      category: security
      technology:
        - express
      cwe:
        - "CWE-306: Missing Authentication for Critical Function"
      references:
        - https://nvd.nist.gov/vuln/detail/CVE-2020-13927
    patterns:
      - pattern-inside: |
          const $APP = require('express');
          ...
          const $INSTANCE = $APP(...);
          ...
          $INSTANCE.$USE($MW);
          ...
      - pattern-either:
          # Listar tareas sin autenticación
          - pattern: |
              $INSTANCE.get('/api/experimental/tasks', ($REQ, $RES) => {
                ...
              });
          # Disparar tarea sin autenticación
          - pattern: |
              $INSTANCE.post('/api/experimental/tasks/:$TASKID/trigger', ($REQ, $RES) => {
                ...
              });
          # Modificar configuración de tarea sin autenticación
          - pattern: |
              $INSTANCE.put('/api/experimental/tasks/:$TASKID/config', ($REQ, $RES) => {
                ...
              });