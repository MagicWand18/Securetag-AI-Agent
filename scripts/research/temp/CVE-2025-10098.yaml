rules:
  - id: synthetic-cve202510098
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible SQL Injection (CVE-2025-10098): se construye dinámicamente una
      consulta SQL concatenando o interpolando datos controlados por el usuario
      (por ejemplo, parámetros de `req.body`, `req.query` o similares) en la
      cadena de consulta pasada a `db.query`/`connection.query` de `mysql`. Un
      atacante puede manipular estos valores para alterar la consulta SQL,
      exfiltrar datos o escalar privilegios. Usa consultas parametrizadas
      (placeholders `?` o bindings) en lugar de concatenar/interpolar valores
      directamente en la cadena SQL.
    metadata:
      cve: "CVE-2025-10098"
      source: "CISA_KEV"
      category: "security"
      technology: ["nodejs", "express", "mysql"]
      vulnerability: "sql-injection"
    patterns:
      - pattern-either:
          # mysql / mysql2 style: db.query(sql, ...)
          - pattern: |
              $DB.query($SQL, ...);
          # connection.query(sql, ...)
          - pattern: |
              $CONN.query($SQL, ...);
      - pattern-either:
          # SQL construido con template literal que incluye valores no constantes
          - pattern: |
              const $SQL = `$X${...}$Y`;
          - pattern: |
              let $SQL = `$X${...}$Y`;
          - pattern: |
              var $SQL = `$X${...}$Y`;
          # SQL construido por concatenación con +
          - pattern: |
              const $SQL = $X + $Y;
          - pattern: |
              let $SQL = $X + $Y;
          - pattern: |
              var $SQL = $X + $Y;
      - pattern-either:
          # Origen típico de datos controlados por el usuario en Express
          - pattern: |
              $SRC = $REQ.body.$FIELD;
          - pattern: |
              $SRC = $REQ.query.$FIELD;
          - pattern: |
              $SRC = $REQ.params.$FIELD;
          - pattern: |
              $SRC = $REQ.headers[$H];
      - pattern-either:
          # El valor controlado por el usuario se usa en la construcción del SQL
          - pattern: |
              const $SQL = ... $SRC ...;
          - pattern: |
              let $SQL = ... $SRC ...;
          - pattern: |
              var $SQL = ... $SRC ...;
          - pattern: |
              $SQL = ... $SRC ...;
      - pattern-not: |
          // Exclusión básica de consultas parametrizadas con placeholders
          $DB.query($SQL, [...]);
      - pattern-not: |
          // Exclusión básica de consultas parametrizadas con objeto de parámetros
          $DB.query($SQL, {...});
    fix: >
      Usa consultas parametrizadas. Por ejemplo:
      `const sql = "UPDATE users SET full_name = ?, email = ? WHERE id = ?"; db.query(sql, [fullName, email, uid]);`