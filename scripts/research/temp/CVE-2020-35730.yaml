rules:
  - id: synthetic-cve202035730
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible XSS al interpolar directamente datos controlados por el usuario
      dentro de atributos HTML (por ejemplo, href) sin escape ni validación.
      Esto puede permitir la inyección de payloads como "javascript:alert(1)"
      o romper el atributo con comillas, en línea con el riesgo descrito en
      CVE-2020-35730 y su alta probabilidad de explotación.
    metadata:
      cve: "CVE-2020-35730"
      source: "CISA_KEV"
      category: "security"
      technology: ["nodejs", "express"]
      vulnerability: ["xss", "reflected-xss", "stored-xss"]
    patterns:
      - pattern-inside: |
          $APP = require('express');
          ...
      - pattern-either:
          - pattern: |
              $HTML = $BODY.replace($REGEX, ($M) => {
                ...
                `<a href="${$M}">${...}</a>`
                ...
              });
          - pattern: |
              $HTML = $BODY.replace($REGEX, function ($M) {
                ...
                `<a href="${$M}">${...}</a>`
                ...
              });
          - pattern: |
              $HTML = $BODY.replace($REGEX, ($M) => {
                ...
                "<a href=\"" + $M + "\">" + ... + "</a>"
                ...
              });
          - pattern: |
              $HTML = $BODY.replace($REGEX, function ($M) {
                ...
                "<a href=\"" + $M + "\">" + ... + "</a>"
                ...
              });
      - pattern-inside: |
          app.post($ROUTE, ($REQ, $RES) => {
            ...
            $BODY = $REQ.body.$FIELD || '';
            ...
          });
      - pattern-not: |
          $HTML = $BODY.replace($REGEX, ($M) => {
            ...
            $SAFE = $ESCAPER($M);
            ...
            `<a href="${$SAFE}">${...}</a>`
            ...
          });
      - pattern-not: |
          $HTML = $BODY.replace($REGEX, function ($M) {
            ...
            $SAFE = $ESCAPER($M);
            ...
            "<a href=\"" + $SAFE + "\">" + ... + "</a>"
            ...
          });