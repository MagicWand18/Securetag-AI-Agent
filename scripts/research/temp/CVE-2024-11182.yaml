rules:
  - id: synthetic-cve202411182
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible XSS al renderizar directamente contenido HTML controlado por el usuario
      (por ejemplo, cuerpo de correo) dentro de una respuesta HTTP sin sanitización.
      Un atacante puede inyectar etiquetas <script> u otros payloads HTML/JS que se
      ejecuten en el navegador del usuario. Esto está relacionado con CVE-2024-11182,
      que describe un visor de correos web que muestra el cuerpo HTML tal cual llega,
      con alta probabilidad de explotación (25.7%).
    metadata:
      cve: "CVE-2024-11182"
      source: "CISA_KEV"
      category: "security"
      cwe: "CWE-79"
      likelihood_of_exploit: "high"
      references:
        - "https://www.cve.org/CVERecord?id=CVE-2024-11182"
    patterns:
      - pattern-inside: |
          http.createServer(..., (req, res) => {
            ...
          })
      - pattern-either:
          - pattern: |
              res.end(`...${$HTML}...`)
          - pattern: |
              res.end("..."+$HTML+"...")
          - pattern: |
              res.end($TEMPLATE)
      - pattern-not: |
          res.end($SANITIZER(...))
      - metavariable-pattern:
          metavariable: $HTML
          pattern-either:
            - pattern: email.htmlBody
            - pattern: $OBJ.htmlBody
            - pattern: $OBJ.body
            - pattern: $OBJ.html
            - pattern: $OBJ.content
            - pattern: $OBJ[$KEY]
    fix: >
      Sanitiza o escapa el contenido HTML antes de insertarlo en la respuesta, por ejemplo
      usando una librería de sanitización (DOMPurify, sanitize-html, etc.) o renderizando
      solo una versión escapada del texto en lugar de HTML crudo.