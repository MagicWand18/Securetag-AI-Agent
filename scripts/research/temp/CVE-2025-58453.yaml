rules:
  - id: synthetic-cve202558453
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible SQL Injection (CVE-2025-58453): se construye dinámicamente una consulta SQL
      concatenando directamente datos controlados por el usuario (por ejemplo, req.query.id_anexo)
      en la cláusula WHERE antes de pasarlos a db.query. Un atacante puede manipular el parámetro
      para alterar la consulta, extraer o modificar datos sensibles, o dañar la base de datos.
      Usa consultas parametrizadas/preparadas (placeholders) en lugar de concatenación de strings.
    metadata:
      cve: "CVE-2025-58453"
      source: "CISA_KEV"
      category: "security"
      technology: ["nodejs", "express", "mysql2"]
      likelihood: "HIGH"
      impact: "HIGH"
      vulnerability_class: ["SQL Injection"]
    patterns:
      - pattern-either:
          # Caso típico: template string con interpolación de variable controlada
          - pattern: |
              $DB.$QUERY_FN(`... = ${$USER_INPUT}...`, ...)
          # Concatenación con +
          - pattern: |
              $DB.$QUERY_FN("..." + $USER_INPUT + "...", ...)
          - pattern: |
              $DB.$QUERY_FN('...' + $USER_INPUT + '...', ...)
      - pattern-inside: |
          const $APP = require('express');
          ...
          $APP.$METHOD($ROUTE, ($REQ, $RES, ...$REST) => {
            ...
            $USER_INPUT = $REQ.$PROP.$KEY;
            ...
          });
      - pattern-inside: |
          const $DB = require('mysql2').createConnection(...);
          ...
      - pattern-inside: |
          $DB.$QUERY_FN($SQL, ...);
      - pattern-not: |
          $DB.$QUERY_FN($SQL, [$USER_INPUT, ...], ...);
      - pattern-not: |
          $DB.$QUERY_FN($SQL, { ... }, ...);