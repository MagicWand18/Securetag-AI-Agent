rules:
  - id: synthetic-cve202524404
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible XXE / XML Injection (CVE-2025-24404): se está usando `xml2js.Parser`
      sin desactivar entidades externas ni limitar la expansión de entidades.
      Un atacante que controle el XML (por ejemplo, contenido obtenido desde una URL
      proporcionada por el usuario) puede abusar de la resolución de entidades
      externas para leer archivos locales, acceder a servicios internos o, en
      algunos entornos/parsers, lograr RCE. Configure el parser con opciones
      seguras (p.ej. deshabilitar entidades externas, limitar tamaño/estructura)
      o valide/sanitize el XML antes de parsearlo.
    metadata:
      cve: "CVE-2025-24404"
      source: "CISA_KEV"
      category: security
      technology:
        - nodejs
        - express
        - xml
      vulnerability_class:
        - "XML External Entity (XXE)"
        - "XML Injection"
    patterns:
      - pattern: |
          new xml2js.Parser($OPTS)
      - pattern-not: |
          new xml2js.Parser({
            ...,
            explicitCharkey: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            explicitRoot: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            explicitArray: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            normalizeTags: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            normalize: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            attrkey: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            charkey: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            tagNameProcessors: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            attrNameProcessors: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            valueProcessors: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            attrValueProcessors: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            xmlns: $X,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            strict: false,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            strict: true,
            ...,
          })
      - pattern-not: |
          new xml2js.Parser({
            ...,
            $KEY: $VAL,
            ...,
          })
    fix: >
      Evita parsear XML controlado por el usuario con la configuración por defecto
      de `xml2js.Parser`. Usa opciones seguras (p.ej. deshabilitar entidades
      externas si tu versión/parsers lo soportan, limitar tamaño/estructura del
      XML) o cambia a una librería que ofrezca controles explícitos contra XXE.