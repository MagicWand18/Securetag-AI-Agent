const express = require('express');
const app = express();

// Simula un endpoint de vista de correo que incrusta contenido SVG "tal cual"
// Vulnerable a XSS v√≠a atributos <animate> en SVG (similar a CVE-2024-37383)

app.get('/view-svg', (req, res) => {
  const userSvg = req.query.svg || '<svg><text>No SVG</text></svg>';

  // RESPUESTA VULNERABLE: se inserta el SVG sin sanitizar
  // Un atacante puede enviar algo como:
  // ?svg=<svg><animate attributeName="onbegin" from="0" to="1" onbegin="alert(1)"/></svg>

  const html = `<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8" />
      <title>Vista SVG</title>
    </head>
    <body>
      <h1>Vista de SVG (VULNERABLE)</h1>
      <div id="svg-container">
        ${userSvg}
      </div>
    </body>
  </html>`;

  res.setHeader('Content-Type', 'text/html; charset=utf-8');
  res.send(html);
});

app.listen(3000, () => {
  console.log('Servidor vulnerable escuchando en http://localhost:3000/view-svg?svg=...');
});
