rules:
  - id: synthetic-cve20256558
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible explotación similar a CVE-2025-6558: entrada controlada por el atacante
      se inyecta directamente en HTML/JavaScript y, en el mismo flujo, se usa sin
      validación para construir un comando de sistema con `exec`. Este patrón crea
      un puente entre datos de renderizado (p.ej. shaders/HTML dinámico) y una capa
      nativa/externa (GPU worker, procesos auxiliares), permitiendo inyección de
      contenido arbitrario en el contexto de la página y potencial ejecución de
      comandos. Valida/escapa la entrada y evita concatenar parámetros no
      sanitizados en comandos de shell.
    metadata:
      cve: "CVE-2025-6558"
      source: "CISA_KEV"
      category: security
      technology: [nodejs, express]
      likelihood: HIGH
      impact: HIGH
    patterns:
      # 1) Ruta HTTP que recibe datos del body (controlados por el atacante)
      - pattern: |
          $APP.$METHOD($ROUTE, ($REQ, $RES) => {
            ...
          })
      - metavariable-pattern:
          metavariable: $METHOD
          pattern-either:
            - pattern: post
            - pattern: put
            - pattern: all
      - pattern-inside: |
          $APP.$METHOD($ROUTE, ($REQ, $RES) => {
            const { $SHADER, $GPUFLAG, ...$REST } = $REQ.body;
            ...
          })
      # 2) Construcción de HTML que incluye directamente una de esas variables
      - pattern-either:
          - pattern: |
              const $HTML = `
                ...
                ${$SHADER}
                ...
              `;
          - pattern: |
              let $HTML = `
                ...
                ${$SHADER}
                ...
              `;
      # 3) Uso de child_process.exec con concatenación de la otra variable en el comando
      - pattern-either:
          - pattern: |
              const { exec } = require('child_process');
              ...
              const $CMD = `... ${$GPUFLAG} ...`;
              exec($CMD, ($ERR, $STDOUT, $STDERR) => {
                ...
              });
          - pattern: |
              const child_process = require('child_process');
              ...
              const $CMD = `... ${$GPUFLAG} ...`;
              child_process.exec($CMD, ($ERR, $STDOUT, $STDERR) => {
                ...
              });
      # 4) Aseguramos que ambas variables provienen del mismo destructuring del body
      - metavariable-comparison:
          metavariable: $SHADER
          comparison: $SHADER != $GPUFLAG