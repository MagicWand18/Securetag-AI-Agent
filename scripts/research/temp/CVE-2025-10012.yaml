rules:
  - id: synthetic-cve202510012
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible SQL Injection (CVE-2025-10012-like): se construye dinámicamente
      una consulta SQL concatenando directamente datos controlados por el
      usuario (por ejemplo, req.query.ref_cod_aluno) en la cadena de consulta
      antes de pasarlos a db.query(). Un atacante puede manipular el parámetro
      para alterar la consulta SQL, extraer o modificar datos sensibles o
      comprometer la base de datos. Use consultas parametrizadas/preparadas
      (placeholders) en lugar de concatenación de strings.
    metadata:
      cve: "CVE-2025-10012"
      source: "CISA_KEV"
      category: "security"
      technology: ["nodejs", "express", "mysql2"]
      vulnerability: "sql-injection"
    patterns:
      - pattern-either:
          # Caso 1: template string con interpolación de variable controlada
          - pattern: |
              $DB.$QUERY_FN(`... = ${$USER_INPUT} ...`, ...)
          # Caso 2: concatenación clásica con +
          - pattern: |
              $DB.$QUERY_FN("..." + $USER_INPUT + "...", ...)
      - pattern-inside: |
          app.$ROUTE_METHOD($ROUTE, ($REQ, $RES, ...) => {
            ...
          })
      - pattern-inside: |
          const $USER_INPUT = $REQ.query.$PARAM;
      - pattern-inside: |
          const $DB = require('mysql2').createConnection(...);
      - metavariable-regex:
          metavariable: $QUERY_FN
          regex: ^(query|execute|executeQuery|raw|run)$
      - metavariable-regex:
          metavariable: $ROUTE_METHOD
          regex: ^(get|post|put|delete|patch|all|use)$