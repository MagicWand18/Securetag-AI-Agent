rules:
  - id: synthetic-cve202548927
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Endpoint sensible similar a un heapdump expuesto sin autenticación ni controles
      de acceso. Esto puede filtrar información altamente sensible del estado de la
      memoria de la aplicación (tokens, credenciales, datos de usuarios, secretos),
      análogo a los endpoints de diagnóstico /heapdump de frameworks como Spring Boot
      Actuator. Revise y proteja este endpoint con autenticación/autorización robusta
      o deshabilítelo si no es estrictamente necesario. Asociado a CVE-2025-48927.
    metadata:
      cve: "CVE-2025-48927"
      source: "CISA_KEV"
      category: security
      technology: [nodejs, express]
      likelihood: HIGH
      impact: HIGH
      confidence: MEDIUM
    patterns:
      - pattern-either:
          # app.get('/heapdump', ...) style
          - pattern: |
              $APP.get($ROUTE, ($REQ, $RES) => {
                ...
                fs.createReadStream($HEAPDUMP_PATH).pipe($RES);
                ...
              })
          # app.get('/heapdump', handler); function handler(req,res){...}
          - pattern: |
              $APP.get($ROUTE, $HANDLER);
          # router.get('/heapdump', ...) style
          - pattern: |
              $ROUTER.get($ROUTE, ($REQ, $RES) => {
                ...
                fs.createReadStream($HEAPDUMP_PATH).pipe($RES);
                ...
              })
          - pattern: |
              $ROUTER.get($ROUTE, $HANDLER);
      - pattern-inside: |
          const fs = require('fs');
          ...
      - pattern-inside: |
          fs.createReadStream($HEAPDUMP_PATH).pipe($RES);
      - pattern-inside: |
          $HEAPDUMP_PATH = path.join(__dirname, $FILENAME);
          ...
      - pattern-inside: |
          $APP = express();
          ...
      - metavariable-pattern:
          metavariable: $ROUTE
          pattern: |
            '/heapdump'
      - metavariable-pattern:
          metavariable: $FILENAME
          pattern: |
            'heapdump.hprof'
      - pattern-not: |
          $APP.get($ROUTE, $MIDDLEWARE, ($REQ, $RES) => {
            ...
          })
      - pattern-not: |
          $ROUTER.get($ROUTE, $MIDDLEWARE, ($REQ, $RES) => {
            ...
          })