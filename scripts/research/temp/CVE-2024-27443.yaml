rules:
  - id: synthetic-cve202427443
    languages: [javascript, typescript]
    severity: ERROR
    message: >
      Posible XSS almacenado/reflejado en generación de HTML a partir de datos
      de invitaciones de calendario sin escape ni sanitización. Datos controlados
      por el usuario (por ejemplo, organizer, subject, location, description,
      startTime, endTime) provenientes de req.body se interpolan directamente en
      una plantilla HTML enviada con Content-Type text/html. Esto permite a un
      atacante inyectar código JavaScript malicioso (por ejemplo, en el campo
      subject con <img src=x onerror="...">), similar al escenario descrito en
      CVE-2024-27443, con alta probabilidad de explotación (32.3%).
    metadata:
      cve: "CVE-2024-27443"
      source: "CISA_KEV"
      category: security
      technology: [express, nodejs]
      cwe: "CWE-79"
    patterns:
      - pattern-inside: |
          app.$METHOD($ROUTE, ($REQ, $RES) => {
            ...
          })
      - pattern-inside: |
          const $HTML = `
            ...
          `;
          ...
          $RES.setHeader('Content-Type', 'text/html' , ...);
          ...
          $RES.send($HTML);
      - pattern-either:
          - pattern: |
              const $HTML = `
                ...
                ${$REQ.body.$FIELD}
                ...
              `;
          - pattern: |
              const $HTML = `
                ...
                ${$REQ.$PROP.$FIELD}
                ...
              `;
    fix: >
      Escapa o sanitiza todos los valores provenientes de req.body antes de
      interpolarlos en HTML (por ejemplo, usando una función de escape de HTML o
      una librería de plantillas segura) o utiliza un motor de plantillas que
      haga escape automático del contenido.