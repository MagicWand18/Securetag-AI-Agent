rules:
  - id: synthetic-cve202527915
    languages: [javascript, typescript]
    message: >
      Posible XSS al insertar directamente contenido de un archivo ICS (por ejemplo,
      el campo DESCRIPTION) en HTML sin escape ni sanitización. Un atacante puede
      inyectar HTML/JS en el ICS (p.ej. DESCRIPTION:<div ontoggle="alert(1)"></div>)
      que se renderiza en el navegador, explotando CVE-2025-27915. Valida, escapa o
      sanitiza el contenido antes de interpolarlo en plantillas HTML.
    severity: ERROR
    metadata:
      cve: "CVE-2025-27915"
      source: "CISA_KEV"
      category: security
      technology: [nodejs, express]
      cwe: "CWE-79"
    patterns:
      - pattern-either:
          # Caso 1: lectura de ICS con fs.readFile / fs.readFileSync
          - pattern: |
              fs.readFile($ICS_PATH, ..., (err, $DATA) => {
                ...
              });
          - pattern: |
              $DATA = fs.readFileSync($ICS_PATH, ...);
      - pattern-inside: |
          const $APP = require('express')(...);
          ...
      - pattern-inside: |
          $APP.get($ROUTE, ($REQ, $RES) => {
            ...
            $FUNC(..., (err, $DATA) => {
              ...
              $HTML = `... ${$DESC} ...`;
              ...
              $RES.setHeader('Content-Type', 'text/html' , ...);
              $RES.send($HTML);
            });
          });
      - pattern-either:
          # Extracción ingenua de DESCRIPTION u otros campos ICS
          - pattern: |
              $MATCH = $DATA.match(/DESCRIPTION:(.*)/);
              $DESC = $MATCH ? $MATCH[1] : $FALLBACK;
          - pattern: |
              $DESC = $DATA.match(/DESCRIPTION:(.*)/)[1];
      - pattern-not: |
          $SAFE_DESC = $SANITIZE($DESC);
      - pattern-not: |
          $HTML = $ESCAPE($DESC);
```