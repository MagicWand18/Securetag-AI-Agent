const express = require('express');
const app = express();

// Simulación de metadatos internos de la app
const buildInfo = {
  name: 'my-terraform-webhook-service',
  version: '1.3.7',              // versión exacta
  commit: 'a1b2c3d4e5f6',        // hash de commit
  buildDate: '2025-11-30T10:15:00Z',
  goVersion: 'go1.23.1',         // versión del runtime (similar a Atlantis en Go)
  os: process.platform,
  arch: process.arch,
  dependencies: {
    express: '4.21.0',
    axios: '1.7.0',
    'terraform-lib': '0.9.3'
  }
};

// ENDPOINT VULNERABLE: expone demasiada información de versión públicamente
app.get('/status', (req, res) => {
  // Información detallada que un atacante puede usar para hacer fingerprinting
  res.json({
    status: 'ok',
    uptime: process.uptime(),
    buildInfo
  });
});

// Resto de la app (simulación de webhook de PR de Terraform)
app.post('/webhook', express.json(), (req, res) => {
  // lógica de procesamiento de PR de Terraform...
  res.status(202).json({ received: true });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Service listening on port ${PORT}`);
});
