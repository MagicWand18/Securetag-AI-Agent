rules:
  - id: synthetic-cve202510115
    languages:
      - javascript
      - typescript
    message: >
      Posible SQL Injection (CVE-2025-10115): se construye dinámicamente una
      consulta SQL concatenando directamente parámetros controlados por el
      usuario (por ejemplo, req.query.name o req.query.username) en la cadena
      de la consulta antes de pasársela a db.query(). Un atacante puede
      inyectar payloads como `admin' OR '1'='1` para alterar la lógica de la
      consulta, extraer datos sensibles o modificar la base de datos. Use
      consultas parametrizadas/preparadas en lugar de concatenar cadenas.
    severity: ERROR
    metadata:
      cve: CVE-2025-10115
      source: CISA_KEV
      category: security
      technology:
        - nodejs
        - express
        - mysql
      vulnerability: sql-injection
    patterns:
      - pattern-either:
          # Caso 1: query construida en variable y luego pasada a db.query(...)
          - patterns:
              - pattern: |
                  $DB = require('mysql2');
                  ...
                  $CONN = $DB.$CREATECONNECTION(...);
                  ...
                  $SQL = "...";
                  ...
                  $SQL += $X;
                  ...
                  $CONN.query($SQL, ...);
              - pattern-inside: |
                  app.$METHOD($ROUTE, ($REQ, $RES, ...) => {
                    ...
                  })
              - pattern-either:
                  - pattern-inside: |
                      const $NAME = $REQ.query.$PARAM;
                      ...
                  - pattern-inside: |
                      let $NAME = $REQ.query.$PARAM;
                      ...
                  - pattern-inside: |
                      var $NAME = $REQ.query.$PARAM;
                      ...
              - pattern: $SQL += "..." + $NAME + "...";
          # Caso 2: concatenación directa de req.query.* en la cadena SQL
          - patterns:
              - pattern-inside: |
                  app.$METHOD($ROUTE, ($REQ, $RES, ...) => {
                    ...
                  })
              - pattern: |
                  $CONN.query("..." + $REQ.query.$PARAM + "...", ...);