
import sys
import os

# A√±adir el directorio actual al path para poder importar cve_enricher
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from cve_enricher import fetch_exploit_code

def test_extraction():
    # URL de ejemplo de Exploit-DB (SQL Injection en alg√∫n CMS, ejemplo gen√©rico)
    # Usaremos una URL que sepamos que existe. 
    # Por ejemplo, Exploit 49598 (sudo heap overflow) o algo web.
    test_refs = [
        "https://www.exploit-db.com/exploits/50950", # Un exploit de Python
        "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/http/log4shell_header_injection.rb" # GitHub fallback
    ]
    
    print("üîç Probando extracci√≥n de c√≥digo de exploit...")
    print(f"Objetivos: {test_refs}")
    
    code = fetch_exploit_code(test_refs)
    
    if code:
        print("\n‚úÖ EXTRACCI√ìN EXITOSA!")
        print("="*40)
        print(code[:500] + "\n... [truncado] ...")
        print("="*40)
    else:
        print("\n‚ùå FALLO: No se pudo extraer c√≥digo.")

if __name__ == "__main__":
    test_extraction()
