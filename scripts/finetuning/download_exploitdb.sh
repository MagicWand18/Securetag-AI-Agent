#!/bin/bash

# Configuraci√≥n
BASE_DIR="$(cd "$(dirname "$0")/../../" && pwd)"
SOURCES_DIR="$BASE_DIR/sources"
EXPLOITDB_DIR="$SOURCES_DIR/exploitdb"

echo "=== Fase 1: Descarga de Exploit-DB ==="
echo "Directorio base: $BASE_DIR"

# Crear directorio sources si no existe
mkdir -p "$SOURCES_DIR"

if [ -d "$EXPLOITDB_DIR" ]; then
    echo "[INFO] El directorio exploitdb ya existe. Actualizando..."
    cd "$EXPLOITDB_DIR"
    git pull
else
    echo "[INFO] Clonando repositorio oficial de Exploit-DB..."
    cd "$SOURCES_DIR"
    git clone https://gitlab.com/exploit-database/exploitdb.git
fi

# Verificar archivos cr√≠ticos
if [ -f "$EXPLOITDB_DIR/files_exploits.csv" ]; then
    echo "‚úÖ Archivo files_exploits.csv encontrado."
    COUNT=$(wc -l < "$EXPLOITDB_DIR/files_exploits.csv")
    echo "üìä Total de entradas en √≠ndice: $COUNT"
else
    echo "‚ùå Error: files_exploits.csv no encontrado."
    exit 1
fi

echo "=== Descarga completada ==="
