rules:
  - id: crypto-js-weak-algo
    message: >-
      Se detectó el uso de un algoritmo de hash débil (MD5/SHA1).
      Estos algoritmos son vulnerables a colisiones. Use SHA-256 o superior.
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      cwe: "CWE-327: Use of a Broken or Risky Cryptographic Algorithm"
      owasp: "A02:2021 - Cryptographic Failures"
      category: security
      technology:
        - crypto-js
      likelihood: HIGH
      impact: MEDIUM
      confidence: HIGH
      references:
        - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html
    patterns:
      - pattern-either:
          - pattern: CryptoJS.MD5(...)
          - pattern: CryptoJS.SHA1(...)
          - pattern: MD5($MSG)
          - pattern: SHA1($MSG)

  - id: crypto-js-hardcoded-secret
    message: >-
      Se detectó un posible secreto hardcodeado utilizado en encriptación.
      Las claves no deben almacenarse en el código fuente. Use variables de entorno o gestión de secretos segura.
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      category: security
      technology:
        - crypto-js
      likelihood: HIGH
      impact: HIGH
      confidence: MEDIUM
      references:
        - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
    patterns:
      - pattern-either:
          - pattern: CryptoJS.AES.encrypt($MSG, "...")
          - pattern: AES.encrypt($MSG, "...")

  - id: axios-interceptor-logging
    message: >-
      Se detectó 'console.log' dentro de interceptores de Axios.
      Esto puede provocar fugas de tokens o datos sensibles en la consola del navegador.
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      cwe: "CWE-532: Insertion of Sensitive Information into Log File"
      owasp: "A09:2021 - Security Logging and Monitoring Failures"
      category: security
      technology:
        - axios
      likelihood: MEDIUM
      impact: MEDIUM
      confidence: HIGH
      references:
        - https://axios-http.com/docs/interceptors
    patterns:
      - pattern-inside: |
          $INST.interceptors.$TYPE.use(...)
      - pattern: console.log(...)

  - id: pinia-direct-state-mutation
    message: >-
      Se detectó mutación directa del estado de Pinia.
      Aunque Pinia lo permite, es mejor práctica usar acciones para lógica compleja y trazabilidad.
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      category: best-practice
      technology:
        - pinia
        - vue
      likelihood: HIGH
      impact: LOW
      confidence: HIGH
      references:
        - https://pinia.vuejs.org/core-concepts/state.html#mutating-the-state
    patterns:
      - pattern: $STORE.$state.$PROP = $VAL

  - id: lodash-unsafe-merge
    message: >-
      El uso de 'merge' o 'defaultsDeep' de Lodash puede llevar a contaminación de prototipo (Prototype Pollution) si las entradas no están sanitizadas.
      Asegúrese de que el objeto destino sea seguro o use una utilidad de 'safe-merge'.
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      cwe: "CWE-1321: Improperly Controlled Modification of Object Prototype Attributes ('Prototype Pollution')"
      owasp: "A06:2021 - Vulnerable and Outdated Components"
      category: security
      technology:
        - lodash
      likelihood: MEDIUM
      impact: HIGH
      confidence: MEDIUM
      references:
        - https://snyk.io/vuln/SNYK-JS-LODASH-450202
    patterns:
      - pattern-either:
          - pattern: _.merge($A, $B)
          - pattern: _.defaultsDeep($A, $B)
          - pattern: lodash.merge($A, $B)

  - id: pdfmake-unsafe-content
    message: >-
      Inyectar datos no confiables directamente en la generación de PDF puede llevar a inyección de contenido o XSS en algunos visores.
      Sanitice los datos antes de pasarlos a pdfMake.
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      cwe: "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"
      owasp: "A03:2021 - Injection"
      category: security
      technology:
        - pdfmake
      likelihood: LOW
      impact: MEDIUM
      confidence: LOW
    patterns:
      - pattern: pdfMake.createPdf(...)
