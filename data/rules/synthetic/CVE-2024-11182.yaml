rules:
- id: synthetic-cve202411182
  languages:
  - javascript
  - typescript
  message: "Posible XSS almacenado/reflejado similar a CVE-2024-11182: contenido HTML\
    \ de correo (`rawEmailHtml` u otra variable) se inserta directamente en la respuesta\
    \ HTML de Express mediante `res.send()` sin sanitizaci\xF3n ni escape. Un atacante\
    \ puede inyectar `<script>` u otras cargas maliciosas que se ejecutar\xE1n en\
    \ el navegador del usuario. Valida o sanitiza el HTML antes de insertarlo en la\
    \ respuesta.\n"
  severity: ERROR
  metadata:
    cwe: 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
      Scripting'')'
    owasp: A03:2021 - Injection
    category: security
    technology:
    - javascript
    - typescript
    - nodejs
    likelihood: HIGH
    impact: HIGH
    confidence: MEDIUM
    references:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-11182
  patterns:
  - pattern-inside: "app.$ROUTE($PATH, ($REQ, $RES) => {\n  ...\n})\n"
  - pattern: '$RES.setHeader("Content-Type", "text/html" , ...);

      '
  - pattern: '$RES.send(`...${$UNTRUSTED}...`);

      '
  - pattern-not: '$RES.send(`...${sanitize($UNTRUSTED)}...`);

      '
  - pattern-not: '$RES.send(`...${escape($UNTRUSTED)}...`);

      '
  - pattern-not: $RES.send(`...${$SANITIZER($UNTRUSTED)}...`)
