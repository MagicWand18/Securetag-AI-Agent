rules:
- id: synthetic-cve202510083
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible carga de archivos sin restricciones asociada a CVE-2025-10083:\
    \ se detecta el uso de `express-fileupload` donde un archivo proveniente de `req.files`\
    \ se mueve (`mv`) directamente a un directorio p\xFAblico accesible desde la web\
    \ usando su nombre original (`avatar.name` o similar), sin autenticaci\xF3n, sin\
    \ validaci\xF3n de tipo/extensi\xF3n y sin controles adicionales. Esto puede permitir\
    \ a un atacante subir scripts ejecutables (por ejemplo, .js, .php en entornos\
    \ mixtos, etc.) y accederlos v\xEDa URL p\xFAblica, resultando en ejecuci\xF3\
    n remota de c\xF3digo o toma de control del servidor. Revise la l\xF3gica de validaci\xF3\
    n, autenticaci\xF3n y la ubicaci\xF3n de almacenamiento de archivos para mitigar\
    \ el vector descrito en CVE-2025-10083.\n"
  metadata:
    cve: CVE-2025-10083
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - express-fileupload
    likelihood: high
    impact: high
    confidence: medium
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  $FILE = $REQ.files.$FIELD;\n\
        \  ...\n  $UPLOAD_PATH = path.join(__dirname, $PUBLIC_DIR, $SUBDIR, $FILE.name);\n\
        \  ...\n  $FILE.mv($UPLOAD_PATH, ($ERR) => {\n    ...\n  });\n  ...\n});\n"
    - pattern: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  $FILES = $REQ.files;\n\
        \  ...\n  $FILE = $FILES.$FIELD;\n  ...\n  $UPLOAD_PATH = path.join(__dirname,\
        \ $PUBLIC_DIR, $SUBDIR, $FILE.name);\n  ...\n  $FILE.mv($UPLOAD_PATH, ($ERR)\
        \ => {\n    ...\n  });\n  ...\n});\n"
  - pattern-inside: 'const express = require(''express'');

      const fileUpload = require(''express-fileupload'');

      ...

      const app = express();

      app.use(fileUpload());

      ...

      '
  - pattern-inside: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n});\n"
  - metavariable-pattern:
      metavariable: $PUBLIC_DIR
      pattern: '''public'''
  - metavariable-pattern:
      metavariable: $SUBDIR
      pattern: '''uploads'''
  - pattern-not: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  if (!$REQ.files\
      \ || !$REQ.files.$FIELD) {\n    ...\n  }\n  ...\n  if ($REQ.user || $REQ.isAuthenticated\
      \ && $REQ.isAuthenticated()) {\n    ...\n  }\n  ...\n});"
