rules:
- id: synthetic-cve20259990
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible Local File Inclusion / Path Traversal (CVE-2025-9990): se construye\
    \ una ruta de archivo a partir de datos de la petici\xF3n HTTP sin validaci\xF3\
    n adecuada y se pasa directamente a una operaci\xF3n de lectura/inclusi\xF3n de\
    \ archivos. Un atacante puede usar valores como `../../../../etc/passwd` para\
    \ leer archivos arbitrarios del sistema o, en entornos de inclusi\xF3n de plantillas,\
    \ ejecutar c\xF3digo remoto. Valida y restringe el par\xE1metro a un conjunto\
    \ de rutas/plantillas permitidas antes de usarlo.\n"
  metadata:
    cve: CVE-2025-9990
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - http
    vulnerability:
    - lfi
    - path-traversal
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory'
    owasp: A01:2021 - Broken Access Control
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: "const http = require('http');\n...\nhttp.createServer((REQ, RES) =>\
        \ {\n  ...\n  const $PARSED = url.parse(REQ.url, true);\n  ...\n  const $USER\
        \ = $PARSED.query[$KEY] || ...;\n  ...\n  const $BASEDIR = path.join(...);\n\
        \  ...\n  const $TARGET = path.join($BASEDIR, $USER);\n  ...\n  fs.readFile($TARGET,\
        \ ...);\n  ...\n});\n"
    - pattern: 'const $USER = ...;

        ...

        const $BASEDIR = path.join(...);

        ...

        const $TARGET = path.join($BASEDIR, $USER);

        ...

        fs.readFile($TARGET, ...);

        '
  - pattern-not: 'const $USER = "...";

      ...

      const $BASEDIR = path.join(...);

      ...

      const $TARGET = path.join($BASEDIR, $USER);

      ...

      fs.readFile($TARGET, ...);

      '
  fix: "No construyas rutas de archivo directamente desde par\xE1metros de la petici\xF3\
    n. En su lugar, valida el valor contra una lista blanca de nombres permitidos\
    \ y resuelve la ruta final compar\xE1ndola con un directorio base conocido, rechazando\
    \ cualquier intento de traversal (../) u otras rutas absolutas."
