rules:
- id: synthetic-cve202526435
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible vulnerabilidad similar a CVE-2025-26435: un usuario autenticado\
    \ no primario puede modificar configuraciones globales o de otro usuario sin verificaci\xF3\
    n de rol o propiedad. En el patr\xF3n detectado, la petici\xF3n se autentica usando\
    \ un identificador de usuario (`$CURR_ID`), pero la actualizaci\xF3n se aplica\
    \ siempre sobre un usuario \"primario\" o distinto (`$PRIMARY_ID`) sin comprobar\
    \ que el usuario actual tenga rol primario ni que `$CURR_ID === $PRIMARY_ID`.\
    \ Esto permite que un usuario secundario desactive protecciones (por ejemplo,\
    \ `deceptiveAppScanning`) del usuario primario o de todo el dispositivo, reproduciendo\
    \ el contexto de explotaci\xF3n descrito en CVE-2025-26435 (escalada l\xF3gica\
    \ entre perfiles del mismo dispositivo).\n"
  metadata:
    cve: CVE-2025-26435
    source: CISA_KEV
    category: access-control
    technology:
    - express
    - nodejs
    likelihood: high
    impact: high
    description: "Detecci\xF3n de endpoints donde un usuario autenticado puede modificar\
      \ configuraciones globales o de otro usuario (p.ej. usuario primario del dispositivo)\
      \ sin verificaci\xF3n de rol o identidad, an\xE1logo a CVE-2025-26435.\n"
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  const $CURR_ID = $GET_CURRENT_USER_ID($REQ);\n\
        \  const $CURR_USER = $USER_SETTINGS.get($CURR_ID);\n  ...\n  const $PRIMARY_ID\
        \ = $PRIMARY_LITERAL;\n  const $PRIMARY_USER = $USER_SETTINGS.get($PRIMARY_ID);\n\
        \  ...\n  $PRIMARY_USER.$SETTING = $VALUE;\n  ...\n})\n"
    - pattern: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  const $CURR_ID = $GET_CURRENT_USER_ID($REQ);\n\
        \  const $CURR_USER = $USER_SETTINGS.get($CURR_ID);\n  ...\n  const $PRIMARY_ID\
        \ = ...;\n  const $PRIMARY_USER = $USER_SETTINGS.get($PRIMARY_ID);\n  ...\n\
        \  $PRIMARY_USER.$SETTING = $VALUE;\n  ...\n})\n"
  - pattern-not: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  const $CURR_ID =\
      \ $GET_CURRENT_USER_ID($REQ);\n  const $CURR_USER = $USER_SETTINGS.get($CURR_ID);\n\
      \  ...\n  const $PRIMARY_ID = $CURR_ID;\n  const $PRIMARY_USER = $USER_SETTINGS.get($PRIMARY_ID);\n\
      \  ...\n  $PRIMARY_USER.$SETTING = $VALUE;\n  ...\n})\n"
  - pattern-not: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  const $CURR_ID =\
      \ $GET_CURRENT_USER_ID($REQ);\n  const $CURR_USER = $USER_SETTINGS.get($CURR_ID);\n\
      \  ...\n  if ($CURR_USER.role !== 'primary' && $CURR_USER.role !== \"admin\"\
      ) {\n    return $RES.status(403).json(...);\n  }\n  const $PRIMARY_ID = ...;\n\
      \  const $PRIMARY_USER = $USER_SETTINGS.get($PRIMARY_ID);\n  ...\n  $PRIMARY_USER.$SETTING\
      \ = $VALUE;\n  ...\n})\n"
  options:
    symbolic_propagation: true
