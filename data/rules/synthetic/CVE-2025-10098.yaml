rules:
- id: synthetic-cve202510098
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible SQL Injection (CVE-2025-10098): se construye din\xE1micamente\
    \ una consulta SQL concatenando o interpolando datos controlados por el usuario\
    \ (por ejemplo, par\xE1metros de `req.body`, `req.query` o similares) en la cadena\
    \ de consulta pasada a `db.query`/`connection.query` de `mysql`. Un atacante puede\
    \ manipular estos valores para alterar la consulta SQL, exfiltrar datos o escalar\
    \ privilegios. Usa consultas parametrizadas (placeholders `?` o bindings) en lugar\
    \ de concatenar/interpolar valores directamente en la cadena SQL.\n"
  metadata:
    cve: CVE-2025-10098
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - mysql
    vulnerability: sql-injection
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: '$DB.query($SQL, ...);

        '
    - pattern: '$CONN.query($SQL, ...);

        '
  - pattern-either:
    - pattern: 'const $SQL = `$X${...}$Y`;

        '
    - pattern: 'let $SQL = `$X${...}$Y`;

        '
    - pattern: 'var $SQL = `$X${...}$Y`;

        '
    - pattern: 'const $SQL = $X + $Y;

        '
    - pattern: 'let $SQL = $X + $Y;

        '
    - pattern: 'var $SQL = $X + $Y;

        '
  - pattern-either:
    - pattern: '$SRC = $REQ.body.$FIELD;

        '
    - pattern: '$SRC = $REQ.query.$FIELD;

        '
    - pattern: '$SRC = $REQ.params.$FIELD;

        '
    - pattern: '$SRC = $REQ.headers[$H];

        '
  - pattern-either:
    - pattern: |
        const $SQL = ... + $SRC + ...;
    - pattern: |
        let $SQL = ... + $SRC + ...;
    - pattern: |
        var $SQL = ... + $SRC + ...;
    - pattern: |
        $SQL = ... + $SRC + ...;
  - pattern-not: "// Exclusi\xF3n b\xE1sica de consultas parametrizadas con placeholders\n\
      $DB.query($SQL, [...]);\n"
  - pattern-not: "// Exclusi\xF3n b\xE1sica de consultas parametrizadas con objeto\
      \ de par\xE1metros\n$DB.query($SQL, {...});\n"
  fix: 'Usa consultas parametrizadas. Por ejemplo: `const sql = "UPDATE users SET
    full_name = ?, email = ? WHERE id = ?"; db.query(sql, [fullName, email, uid]);`'
