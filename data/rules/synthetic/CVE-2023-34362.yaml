rules:
- id: synthetic-cve202334362
  languages:
  - javascript
  - typescript
  message: "Posible inyecci\xF3n SQL no autenticada similar a CVE-2023-34362: se concatena\
    \ directamente un par\xE1metro controlado por el usuario en una consulta SQL (`db.query(sql,\
    \ ...)`) sin usar par\xE1metros preparados ni escape seguro. Un atacante puede\
    \ manipular el par\xE1metro (por ejemplo `?id=1;DROP TABLE users--`) para ejecutar\
    \ SQL arbitrario, lo que permite acceso o destrucci\xF3n de datos.\n"
  severity: ERROR
  metadata:
    cve: CVE-2023-34362
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - mysql
    likelihood: high
    impact: high
    vulnerability_class:
    - SQL Injection
    confidence: MEDIUM
    cwe: 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: '$DB.$QUERY_FN(`... = ${$PARAM}...`, ...)

        '
    - pattern: '$DB.$QUERY_FN("..." + $PARAM + "...", ...)

        '
  - pattern-inside: "$DB = require('mysql2');\n...\n$CONN = $DB.$CREATE_CONN(...);\n\
      ...\napp.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  $PARAM = $REQ.$SRC.$FIELD;\n\
      \  ...\n  $CONN.$QUERY_FN($SQL, ...);\n  ...\n});\n"
  - metavariable-pattern:
      metavariable: $SRC
      pattern-either:
      - pattern: query
      - pattern: params
      - pattern: body
  - metavariable-pattern:
      metavariable: $QUERY_FN
      pattern-either:
      - pattern: query
      - pattern: execute
  - metavariable-pattern:
      metavariable: $CREATE_CONN
      pattern-either:
      - pattern: createConnection
      - pattern: createPool
  - pattern-not: $DB.$QUERY_FN($SQL, [$PARAM], ...)
