rules:
- id: synthetic-cve202558745
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible explotaci\xF3n de CVE-2025-58745: carga de archivos Excel validando\
    \ \xFAnicamente el MIME type declarado por el cliente (`file.mimetype`) en `multer.fileFilter`,\
    \ sin validar extensi\xF3n ni contenido real. Un atacante puede subir un archivo\
    \ malicioso (por ejemplo, un webshell `.php`) con magic bytes y/o cabeceras manipuladas\
    \ para que parezca un Excel y quede accesible o ejecutable en el servidor.\n"
  metadata:
    cve: CVE-2025-58745
    source: CISA_KEV
    category: file-upload
    likelihood: high
    impact: high
    confidence: medium
    technology:
    - javascript
    - typescript
    - nodejs
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-inside: 'const $MULTER = require(''multer'');

      ...

      '
  - pattern-inside: "const $STORAGE = $MULTER.diskStorage({\n  ...\n});\n"
  - pattern-inside: "const $UPLOAD = $MULTER({\n  storage: $STORAGE,\n  fileFilter:\
      \ ($REQ, $FILE, $CB) => {\n    ...\n  }\n});\n"
  - pattern: "fileFilter: ($REQ, $FILE, $CB) => {\n  const $ALLOWED = [...];\n  if\
      \ ($ALLOWED.includes($FILE.mimetype)) {\n    return $CB(null, true);\n  }\n\
      \  return $CB(new Error(...));\n}\n"
  - pattern-not: "fileFilter: ($REQ, $FILE, $CB) => {\n  ...\n  if ($ALLOWED.includes($FILE.mimetype)\
      \ && $FILE.originalname.endsWith('.xlsx')) {\n    return $CB(null, true);\n\
      \  }\n  ...\n}"
