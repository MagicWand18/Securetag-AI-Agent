rules:
- id: synthetic-cve20255419
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible explotaci\xF3n relacionada con CVE-2025-5419: se est\xE1 ejecutando\
    \ c\xF3digo JavaScript derivado de HTML controlado por el usuario mediante `eval`.\
    \ Este patr\xF3n (extraer scripts inline de un DOM construido a partir de entrada\
    \ externa y luego evaluarlos) permite que un atacante suministre HTML/JS especialmente\
    \ dise\xF1ado que, en motores vulnerables, puede desencadenar corrupci\xF3n de\
    \ memoria (por ejemplo, OOB read/write). Evita usar `eval` sobre datos derivados\
    \ de HTML no confiable; utiliza un motor de plantillas seguro o un sandbox apropiado.\n"
  metadata:
    cve: CVE-2025-5419
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - jsdom
    likelihood: HIGH
    impact: CRITICAL
    references:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-5419
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
  patterns:
  - pattern-either:
    - pattern: "function $EXTRACT_HTML_SCRIPTS($HTML) {\n  ...\n  $INLINE_JS = ...\n\
        \  ...\n  return $INLINE_JS;\n}\n\n...\n\n$USER_HTML = $REQ_BODY;\n$INLINE_JS_2\
        \ = $EXTRACT_HTML_SCRIPTS($USER_HTML);\neval($INLINE_JS_2);\n"
    - pattern: '$CODE = $EXTRACT($HTML);

        eval($CODE);

        '
    - pattern: 'eval($EXTRACT($HTML));

        '
  - pattern-inside: 'const { JSDOM } = require(''jsdom'');

      ...

      '
  - pattern-inside: "function $EXTRACT($HTML) {\n  ...\n  const $DOM = new JSDOM($HTML);\n\
      \  ...\n  $SCRIPTS = $DOM.window.document.querySelectorAll('script');\n  ...\n\
      }\n"
  - pattern-not: eval("...")
