rules:
- id: synthetic-cve202524404
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible XXE / XML Injection (CVE-2025-24404): se est\xE1 usando `xml2js.Parser`\
    \ sin desactivar entidades externas ni limitar la expansi\xF3n de entidades. Un\
    \ atacante que controle el XML (por ejemplo, contenido obtenido desde una URL\
    \ proporcionada por el usuario) puede abusar de la resoluci\xF3n de entidades\
    \ externas para leer archivos locales, acceder a servicios internos o, en algunos\
    \ entornos/parsers, lograr RCE. Configure el parser con opciones seguras (p.ej.\
    \ deshabilitar entidades externas, limitar tama\xF1o/estructura) o valide/sanitize\
    \ el XML antes de parsearlo.\n"
  metadata:
    cve: CVE-2025-24404
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - xml
    vulnerability_class:
    - XML External Entity (XXE)
    - XML Injection
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern: 'new xml2js.Parser($OPTS)

      '
  - pattern-not: "new xml2js.Parser({\n  ...,\n  explicitCharkey: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  explicitRoot: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  explicitArray: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  normalizeTags: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  normalize: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  attrkey: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  charkey: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  tagNameProcessors: $X,\n  ...,\n\
      })\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  attrNameProcessors: $X,\n  ...,\n\
      })\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  valueProcessors: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  attrValueProcessors: $X,\n  ...,\n\
      })\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  xmlns: $X,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  strict: false,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  strict: true,\n  ...,\n})\n"
  - pattern-not: "new xml2js.Parser({\n  ...,\n  $KEY: $VAL,\n  ...,\n})\n"
  fix: "Evita parsear XML controlado por el usuario con la configuraci\xF3n por defecto\
    \ de `xml2js.Parser`. Usa opciones seguras (p.ej. deshabilitar entidades externas\
    \ si tu versi\xF3n/parsers lo soportan, limitar tama\xF1o/estructura del XML)\
    \ o cambia a una librer\xEDa que ofrezca controles expl\xEDcitos contra XXE."
