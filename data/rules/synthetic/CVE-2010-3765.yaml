rules:
- id: synthetic-cve20103765
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "C\xF3digo HTML/JS controlado por el usuario se escribe en un archivo temporal\
    \ y se abre autom\xE1ticamente en un navegador mediante una llamada a 'exec'.\
    \ Esto permite que un atacante ejecute JavaScript arbitrario en el motor del navegador,\
    \ haciendo explotables vulnerabilidades del motor como CVE-2010-3765 (nsCSSFrameConstructor\
    \ / manejo interno de frames en Firefox). No abras contenido HTML/JS no confiable\
    \ en navegadores (especialmente versiones antiguas) sin validaci\xF3n, aislamiento\
    \ o sandboxing.\n"
  metadata:
    cve: CVE-2010-3765
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - javascript
    likelihood: high
    impact: high
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: "const http = require('http');\n...\n$SVR = http.createServer(($REQ,\
        \ $RES) => {\n  ...\n  $REQ.on('end', () => {\n    ...\n    $FS = require('fs');\n\
        \    ...\n    $FS.writeFileSync($TMP, $BODY, ...);\n    ...\n    const { exec\
        \ } = require('child_process');\n    exec($CMD, ...);\n    ...\n  });\n});\n"
    - pattern: "$REQ.on('end', () => {\n  ...\n  $FS.writeFileSync($TMP, $BODY, ...);\n\
        \  ...\n  exec($CMD, ...);\n});\n"
  - pattern-inside: "const { exec } = require('child_process');\n...\n$REQ.on('data',\
      \ $CHUNK => {\n  $BODY += $CHUNK.toString();\n});\n...\n$REQ.on('end', () =>\
      \ {\n  ...\n});\n"
  - pattern-regex: (firefox|seamonkey|thunderbird)
  - pattern-not-regex: headless|--safe-mode|--private
  fix: "No abras directamente en un navegador archivos generados a partir de contenido\
    \ HTML/JS controlado por el usuario. En su lugar, valida/filtra estrictamente\
    \ el contenido, evita usar navegadores vulnerables, o procesa el contenido en\
    \ un entorno aislado (sandbox) sin capacidades de ejecuci\xF3n activa de JavaScript."
