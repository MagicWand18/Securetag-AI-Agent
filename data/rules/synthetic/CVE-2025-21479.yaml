rules:
- id: synthetic-cve202521479
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible vulnerabilidad similar a CVE-2025-21479: se construye un comando\
    \ de GPU/driver con par\xE1metros controlados por el cliente (por ejemplo `micronode`\
    \ y `sequence`) y se pasa directamente a `exec`/`child_process` sin validaci\xF3\
    n de autorizaci\xF3n por micronode ni saneamiento del contenido. Esto puede permitir\
    \ que un atacante ejecute comandos no autorizados en la GPU o fuerce secuencias\
    \ arbitrarias que deriven en corrupci\xF3n de memoria en firmware/driver. Valida\
    \ qu\xE9 micronodes/comandos est\xE1n permitidos por rol y normaliza/filtra la\
    \ secuencia antes de invocar el driver.\n"
  metadata:
    cve: CVE-2025-21479
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    references:
    - https://nodejs.org/api/child_process.html#child_processexeccommand-options-callback
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
  patterns:
  - pattern-either:
    - pattern: '$CP.exec(`$CMD`, ...);

        '
    - pattern: '$CP.exec($CMD, ...);

        '
  - pattern-inside: 'const $CP = require(''child_process'');

      ...

      '
  - pattern-inside: "app.post($ROUTE, ($REQ, $RES) => {\n  ...\n});\n"
  - pattern-either:
    - pattern-regex: 'gpu_.*(driver|micronode|cli).*--micronode

        '
    - pattern-regex: '--micronode\b.*--sequence\b

        '
  - pattern-either:
    - pattern-regex: '(req\.body|$REQ\.body)\.[A-Za-z0-9_]*micronode[A-Za-z0-9_]*|\bmicronode\b

        '
    - pattern-regex: '(req\.body|$REQ\.body)\.[A-Za-z0-9_]*sequence[A-Za-z0-9_]*|\bsequence\b

        '
  - pattern-not: '$CP.exec($SAFE_CMD, ...);

      '
  fix: "No construyas el comando del driver directamente con datos del cliente. Define\
    \ una lista blanca de micronodes y comandos permitidos por rol, valida exhaustivamente\
    \ el contenido de la secuencia (tipos, longitud, caracteres permitidos) y pasa\
    \ los par\xE1metros al driver mediante una API segura o argumentos estructurados\
    \ en lugar de concatenar strings."
