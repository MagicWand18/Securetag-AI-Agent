rules:
- id: synthetic-cve202557819
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible bypass de autenticaci\xF3n de administrador y ejecuci\xF3n de\
    \ SQL arbitrario similar a CVE-2025-57819: se usa un valor controlado por el usuario\
    \ (cabecera, cookie o cuerpo de la petici\xF3n) para construir una consulta SQL\
    \ de autenticaci\xF3n mediante concatenaci\xF3n de strings, y si existe cualquier\
    \ fila se considera al usuario como administrador. Luego, en un endpoint privilegiado\
    \ (por ejemplo /admin o similar), se ejecuta directamente una sentencia SQL arbitraria\
    \ proporcionada por el cliente (p.ej. req.body.rawSql) con pool.query/rawQuery.\
    \ Esto permite a un atacante eludir la autenticaci\xF3n y ejecutar comandos SQL\
    \ arbitrarios en la base de datos, pudiendo derivar en RCE en entornos similares\
    \ al descrito en CVE-2025-57819.\n"
  metadata:
    cwe: 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command
      (''SQL Injection'')'
    owasp: A03:2021 - Injection
    category: security
    technology:
    - javascript
    - typescript
    - nodejs
    likelihood: HIGH
    impact: HIGH
    confidence: MEDIUM
    references:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-57819
  patterns:
  - pattern-inside: "async function $FUNC($REQ, ...) {\n  ...\n}\n"
  - pattern-either:
    - pattern: 'const $RAW = $REQ.headers[$KEY] || ...;

        '
    - pattern: 'const $RAW = $REQ.cookies[$KEY] || ...;

        '
    - pattern: 'const $RAW = $REQ.body[$KEY] || ...;

        '
  - pattern: 'const $SQL = `SELECT $COLUMNS FROM $TABLE WHERE $COL = ''${$RAW}''`;

      '
  - pattern: 'const [$ROWS] = await $POOL.query($SQL);

      '
  - pattern: "if ($ROWS.length === 0) {\n  return false;\n}\n"
  - pattern: 'return true;

      '
  - pattern-inside: "$APP.$METHOD($ROUTE, async ($REQ2, $RES, ...) => {\n  ...\n})\n"
  - pattern-either:
    - pattern: "$APP.post($ROUTE, async ($REQ2, $RES, ...) => {\n  ...\n})\n"
    - pattern: "$APP.get($ROUTE, async ($REQ2, $RES, ...) => {\n  ...\n})\n"
  - pattern: 'const $ISADMIN = await $FUNC($REQ2);

      '
  - pattern: "if (!$ISADMIN) {\n  return $RES.status(401).json(...);\n}\n"
  - pattern: 'const { $RAWSQL } = $REQ2.body;

      '
  - pattern-either:
    - pattern: 'await $POOL.query($RAWSQL);

        '
    - pattern: $POOL.query($RAWSQL);
