rules:
- id: synthetic-cve202510116
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible vulnerabilidad de subida de archivos sin restricciones asociada\
    \ a CVE-2025-10116: se mueve un archivo proporcionado por el usuario (`req.files.*`)\
    \ a una ruta construida con `path.join` usando directamente `file.name` sin validaci\xF3\
    n de tipo, extensi\xF3n o tama\xF1o. Un atacante puede subir scripts ejecutables\
    \ u otros archivos peligrosos a un directorio accesible por el servidor, lo que\
    \ puede conducir a ejecuci\xF3n remota de c\xF3digo o toma de control del sistema.\
    \ Valida el tipo de archivo, restringe extensiones, limita tama\xF1o y no uses\
    \ el nombre original del archivo directamente.\n"
  metadata:
    cve: CVE-2025-10116
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    vulnerability_class:
    - Unrestricted File Upload
    - RCE
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-inside: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n})\n"
  - pattern-either:
    - pattern: 'const $FILE = $REQ.files.$ANY;

        ...

        const $UPLOAD_PATH = path.join($UPLOAD_DIR, $FILE.name);

        ...

        $FILE.mv($UPLOAD_PATH, ...);

        '
    - pattern: 'let $FILE = $REQ.files.$ANY;

        ...

        let $UPLOAD_PATH = path.join($UPLOAD_DIR, $FILE.name);

        ...

        $FILE.mv($UPLOAD_PATH, ...);

        '
    - pattern: 'var $FILE = $REQ.files.$ANY;

        ...

        var $UPLOAD_PATH = path.join($UPLOAD_DIR, $FILE.name);

        ...

        $FILE.mv($UPLOAD_PATH, ...);

        '
  fix: "No uses directamente `file.name` ni aceptes cualquier archivo sin validaci\xF3\
    n. Genera un nombre seguro (por ejemplo, UUID), valida el tipo MIME y la extensi\xF3\
    n contra una lista blanca, y aplica l\xEDmites de tama\xF1o antes de mover el\
    \ archivo."
