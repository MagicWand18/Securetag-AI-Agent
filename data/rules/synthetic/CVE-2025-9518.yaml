rules:
- id: synthetic-cve20259518
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible vulnerabilidad de borrado arbitrario de archivos (CVE-2025-9518):\
    \ se construye una ruta de archivo usando datos controlados por el usuario y se\
    \ pasa directamente a una operaci\xF3n de borrado (`fs.unlink` / `fs.rm`) sin\
    \ validar que el archivo permanezca dentro de un directorio seguro (p.ej. `DEBUG_BASE_DIR`).\
    \ Un atacante puede usar rutas relativas como `../../wp-config.php` u otros archivos\
    \ sensibles para eliminar ficheros arbitrarios en el sistema, tal como en el contexto\
    \ de explotaci\xF3n descrito para CVE-2025-9518.\n"
  metadata:
    cve: CVE-2025-9518
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    vulnerability_class:
    - arbitrary-file-deletion
    - path-traversal
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: 'fs.unlink($TARGET, ...)

        '
    - pattern: 'fs.rm($TARGET, ...)

        '
  - pattern-inside: 'const $BASE_DIR = path.join(...);

      ...

      $TARGET = path.join($BASE_DIR, $USER_INPUT, ...);

      ...

      '
  - pattern-either:
    - pattern-inside: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  $USER_INPUT\
        \ = $REQ.body.$FIELD;\n  ...\n});\n"
    - pattern-inside: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  $USER_INPUT\
        \ = $REQ.query.$FIELD;\n  ...\n});\n"
    - pattern-inside: "app.$METHOD($ROUTE, ($REQ, $RES) => {\n  ...\n  $USER_INPUT\
        \ = $REQ.params.$FIELD;\n  ...\n});\n"
  fix: Valida y normaliza la ruta antes de borrar el archivo. Usa `path.resolve` y
    comprueba que la ruta resultante permanezca dentro del directorio base permitido
    (p.ej. `DEBUG_BASE_DIR`). Rechaza rutas que contengan secuencias de traversal
    (`..`) o que apunten fuera del directorio seguro antes de llamar a `fs.unlink`
    / `fs.rm`.
