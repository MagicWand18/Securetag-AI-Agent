rules:
- id: synthetic-cve202535939
  languages:
  - javascript
  - typescript
  message: "Posible explotaci\xF3n de CVE-2025-35939: un valor de configuraci\xF3\
    n asumido como \"inmutable\" se sobreescribe con datos controlados externamente\
    \ (por ejemplo, req.body.*) y luego se usa como ruta de archivo en una operaci\xF3\
    n de escritura (fs.writeFile / fs.writeFileSync). Esto permite a un atacante redirigir\
    \ la escritura a archivos arbitrarios (p.ej. PHP u otros ejecutables) y lograr\
    \ ejecuci\xF3n de c\xF3digo o modificaci\xF3n persistente del sistema. Valida\
    \ y restringe estrictamente las rutas configurables y evita que par\xE1metros\
    \ web reconfiguren valores cr\xEDticos.\n"
  severity: ERROR
  metadata:
    cve: CVE-2025-35939
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern: "let $CONF = {\n  ...,\n  $KEY: $VAL,\n  ...\n};\n"
  - metavariable-pattern:
      metavariable: $VAL
      pattern-either:
      - pattern: path.join(..., ...)
      - pattern: $EXPR
  - pattern-either:
    - pattern: "if (typeof $REQ.body.$FIELD === 'string') {\n  $CONF.$KEY = $REQ.body.$FIELD;\n\
        }\n"
    - pattern: "if (typeof $REQ.query.$FIELD === 'string') {\n  $CONF.$KEY = $REQ.query.$FIELD;\n\
        }\n"
    - pattern: "if (typeof $REQ.params.$FIELD === 'string') {\n  $CONF.$KEY = $REQ.params.$FIELD;\n\
        }\n"
    - pattern: '$CONF.$KEY = $REQ.body.$FIELD;

        '
    - pattern: '$CONF.$KEY = $REQ.query.$FIELD;

        '
    - pattern: '$CONF.$KEY = $REQ.params.$FIELD;

        '
  - pattern-either:
    - pattern: 'const $TARGET = $CONF.$KEY;

        fs.writeFile($TARGET, $DATA, ...);

        '
    - pattern: 'let $TARGET = $CONF.$KEY;

        fs.writeFile($TARGET, $DATA, ...);

        '
    - pattern: 'var $TARGET = $CONF.$KEY;

        fs.writeFile($TARGET, $DATA, ...);

        '
    - pattern: 'fs.writeFile($CONF.$KEY, $DATA, ...);

        '
    - pattern: 'const $TARGET = $CONF.$KEY;

        fs.writeFileSync($TARGET, $DATA, ...);

        '
    - pattern: 'let $TARGET = $CONF.$KEY;

        fs.writeFileSync($TARGET, $DATA, ...);

        '
    - pattern: 'var $TARGET = $CONF.$KEY;

        fs.writeFileSync($TARGET, $DATA, ...);

        '
    - pattern: 'fs.writeFileSync($CONF.$KEY, $DATA, ...);

        '
  fix: "No permitas que par\xE1metros web (req.body, req.query, req.params) modifiquen\
    \ directamente rutas de archivos de configuraci\xF3n. Usa rutas constantes o listas\
    \ blancas predefinidas y valida estrictamente cualquier entrada antes de usarla\
    \ en operaciones de escritura de archivos."
