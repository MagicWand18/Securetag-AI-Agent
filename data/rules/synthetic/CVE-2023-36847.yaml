rules:
- id: synthetic-cve202336847
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible carga de archivos arbitrarios sin autenticaci\xF3n ni validaci\xF3\
    n, similar a CVE-2023-36847 (Juniper J-Web installAppPackage.php). Un endpoint\
    \ que acepta archivos mediante multer.diskStorage sin validar tipo, tama\xF1o\
    \ ni nombre (usando file.originalname directamente) puede permitir a un atacante\
    \ subir paquetes maliciosos o ejecutar c\xF3digo arbitrario en el servidor.\n"
  metadata:
    cwe: 'CWE-434: Unrestricted Upload of File with Dangerous Type'
    owasp: A05:2021 - Security Misconfiguration
    category: security
    technology:
    - javascript
    - typescript
    - nodejs
    likelihood: HIGH
    impact: HIGH
    confidence: MEDIUM
    references:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-36847
  patterns:
  - pattern-inside: 'const $MULTER = require(''multer'');

      ...

      '
  - pattern: "$STORAGE = $MULTER.diskStorage({\n  destination: ($REQ, $FILE, $CB)\
      \ => {\n    $CB(null, $DEST);\n  },\n  filename: ($REQ2, $FILE2, $CB2) => {\n\
      \    $CB2(null, $FILE2.originalname);\n  },\n});\n"
  - pattern: '$UPLOAD = $MULTER({ storage: $STORAGE, ... });

      '
  - pattern-either:
    - pattern: "$APP.post($ROUTE, $UPLOAD.single($FIELD), ($REQ3, $RES3) => {\n  ...\n\
        });\n"
    - pattern: "$ROUTER.post($ROUTE, $UPLOAD.single($FIELD), ($REQ3, $RES3) => {\n\
        \  ...\n});"
