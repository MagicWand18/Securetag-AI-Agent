rules:
- id: synthetic-cve202558453
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible SQL Injection (CVE-2025-58453): se construye din\xE1micamente\
    \ una consulta SQL concatenando directamente datos controlados por el usuario\
    \ (por ejemplo, req.query.id_anexo) en la cl\xE1usula WHERE antes de pasarlos\
    \ a db.query. Un atacante puede manipular el par\xE1metro para alterar la consulta,\
    \ extraer o modificar datos sensibles, o da\xF1ar la base de datos. Usa consultas\
    \ parametrizadas/preparadas (placeholders) en lugar de concatenaci\xF3n de strings.\n"
  metadata:
    cve: CVE-2025-58453
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - mysql2
    likelihood: HIGH
    impact: HIGH
    vulnerability_class:
    - SQL Injection
    confidence: MEDIUM
    cwe: 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: '$DB.$QUERY_FN(`... = ${$USER_INPUT}...`, ...)

        '
    - pattern: '$DB.$QUERY_FN("..." + $USER_INPUT + "...", ...)

        '
    - pattern: '$DB.$QUERY_FN(''...'' + $USER_INPUT + ''...'', ...)

        '
  - pattern-inside: "const $APP = require('express');\n...\n$APP.$METHOD($ROUTE, ($REQ,\
      \ $RES, ...$REST) => {\n  ...\n  $USER_INPUT = $REQ.$PROP.$KEY;\n  ...\n});\n"
  - pattern-inside: 'const $DB = require(''mysql2'').createConnection(...);

      ...

      '
  - pattern-inside: '$DB.$QUERY_FN($SQL, ...);

      '
  - pattern-not: '$DB.$QUERY_FN($SQL, [$USER_INPUT, ...], ...);

      '
  - pattern-not: $DB.$QUERY_FN($SQL, { ... }, ...);
