rules:
- id: synthetic-cve202548927
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Endpoint sensible similar a un heapdump expuesto sin autenticaci\xF3n\
    \ ni controles de acceso. Esto puede filtrar informaci\xF3n altamente sensible\
    \ del estado de la memoria de la aplicaci\xF3n (tokens, credenciales, datos de\
    \ usuarios, secretos), an\xE1logo a los endpoints de diagn\xF3stico /heapdump\
    \ de frameworks como Spring Boot Actuator. Revise y proteja este endpoint con\
    \ autenticaci\xF3n/autorizaci\xF3n robusta o deshabil\xEDtelo si no es estrictamente\
    \ necesario. Asociado a CVE-2025-48927.\n"
  metadata:
    cve: CVE-2025-48927
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    likelihood: HIGH
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: "$APP.get($ROUTE, ($REQ, $RES) => {\n  ...\n  fs.createReadStream($HEAPDUMP_PATH).pipe($RES);\n\
        \  ...\n})\n"
    - pattern: '$APP.get($ROUTE, $HANDLER);

        '
    - pattern: "$ROUTER.get($ROUTE, ($REQ, $RES) => {\n  ...\n  fs.createReadStream($HEAPDUMP_PATH).pipe($RES);\n\
        \  ...\n})\n"
    - pattern: '$ROUTER.get($ROUTE, $HANDLER);

        '
  - pattern-inside: 'const fs = require(''fs'');

      ...

      '
  - pattern-inside: 'fs.createReadStream($HEAPDUMP_PATH).pipe($RES);

      '
  - pattern-inside: '$HEAPDUMP_PATH = path.join(__dirname, $FILENAME);

      ...

      '
  - pattern-inside: '$APP = express();

      ...

      '
  - metavariable-pattern:
      metavariable: $ROUTE
      pattern: '''/heapdump''

        '
  - metavariable-pattern:
      metavariable: $FILENAME
      pattern: '''heapdump.hprof''

        '
  - pattern-not: "$APP.get($ROUTE, $MIDDLEWARE, ($REQ, $RES) => {\n  ...\n})\n"
  - pattern-not: "$ROUTER.get($ROUTE, $MIDDLEWARE, ($REQ, $RES) => {\n  ...\n})"
