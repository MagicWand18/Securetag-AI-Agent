rules:
- id: synthetic-cve20160752
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible vulnerabilidad de directory traversal similar a CVE-2016-0752:\
    \ se construye una ruta de archivo a partir de datos controlados por el usuario\
    \ (por ejemplo, par\xE1metros de URL) y se pasa directamente a funciones de lectura\
    \ de archivos sin validaci\xF3n ni normalizaci\xF3n adecuada. Un atacante puede\
    \ usar secuencias como \"../\" para acceder a archivos arbitrarios fuera del directorio\
    \ previsto, lo que facilita la explotaci\xF3n remota (alta probabilidad de explotaci\xF3\
    n seg\xFAn contexto de amenaza).\n"
  metadata:
    cve: CVE-2016-0752
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - http
    likelihood_of_exploit: high
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-20: Improper Input Validation'
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: '$FS.readFile($PATH, ...);

        '
    - pattern: '$FS.readFileSync($PATH, ...);

        '
  - pattern-inside: 'const http = require(''http'');

      ...

      '
  - pattern-inside: 'const $FS = require(''fs'');

      ...

      '
  - pattern-inside: 'const $PATHMOD = require(''path'');

      ...

      '
  - pattern-inside: 'const $TEMPLATES_DIR = $PATHMOD.join(__dirname, ...);

      ...

      '
  - pattern-inside: "const server = http.createServer(($REQ, $RES) => {\n  ...\n});\n"
  - pattern-inside: 'const $URLOBJ = new URL($REQ.url, `http://${$REQ.headers.host}`);

      ...

      '
  - pattern-inside: 'const $TEMPLATE_NAME = $URLOBJ.searchParams.get($PARAM) || ...;

      ...

      '
  - pattern-inside: 'const $TEMPLATE_PATH = $PATHMOD.join($TEMPLATES_DIR, $TEMPLATE_NAME
      + $SUFFIX);

      ...

      '
  - pattern: '$FS.readFile($TEMPLATE_PATH, ...);

      '
  fix: "Valida y normaliza el par\xE1metro de plantilla antes de construir la ruta.\
    \ Por ejemplo, restringe a una lista blanca de nombres permitidos o verifica que\
    \ la ruta resultante permanezca dentro de TEMPLATES_DIR usando path.resolve y\
    \ comprobando que el prefijo coincida con el directorio esperado."
