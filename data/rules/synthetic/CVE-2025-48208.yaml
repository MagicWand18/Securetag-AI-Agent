rules:
- id: synthetic-cve202548208
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible LDAP Injection (CVE-2025-48208): se construye un filtro LDAP concatenando\
    \ directamente datos controlados por el usuario (por ejemplo, `req.body.filter`)\
    \ en la cadena de b\xFAsqueda (`opts.filter` o par\xE1metro `filter` de `client.search`).\
    \ Un atacante autenticado puede inyectar operadores LDAP especiales (`*`, `)`,\
    \ `(|`, etc.) para alterar la consulta, eludir controles de acceso o extraer informaci\xF3\
    n sensible. Valida y escapa los valores de entrada antes de construir filtros\
    \ LDAP o utiliza APIs que manejen par\xE1metros de forma segura.\n"
  metadata:
    cve: CVE-2025-48208
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    - ldapjs
    cwe: 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query
      (''LDAP Injection'')'
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    owasp: A03:2021 - Injection
    references:
    - https://cwe.mitre.org/data/definitions/20.html
  patterns:
  - pattern-either:
    - pattern: '$CLIENT.search($BASE_DN, { ..., filter: $FILTER, ... }, ...);

        '
    - pattern: '$CLIENT.search($BASE_DN, $FILTER, ...);

        '
  - pattern-inside: '$CLIENT = require(''ldapjs'');

      ...

      '
  - pattern-inside: 'const $APP = require(''express'')();

      ...

      '
  - pattern-inside: "$APP.$METHOD($ROUTE, ..., (req, res, ... ) => {\n  ...\n});\n"
  - pattern-either:
    - pattern: '$FILTER = `...${req.$SRC}...`;

        '
    - pattern: '$FILTER = `...${req.$SRC.$FIELD}...`;

        '
    - pattern: '$FILTER = "..."+req.$SRC+"...";

        '
    - pattern: '$FILTER = "..."+req.$SRC.$FIELD+"...";

        '
    - pattern: '$FILTER = req.$SRC + "...";

        '
    - pattern: '$FILTER = req.$SRC.$FIELD + "...";

        '
  - metavariable-pattern:
      metavariable: $SRC
      pattern: 'body

        '
  - pattern-not: '$FILTER = $SANITIZE(...);

      '
  - pattern-not: '$FILTER = $SANITIZE(req.$SRC);

      '
  - pattern-not: $FILTER = $SANITIZE(req.$SRC.$FIELD);
