rules:
- id: synthetic-cve20091151
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible vulnerabilidad similar a CVE-2009-1151: se est\xE1 generando un\
    \ archivo PHP de configuraci\xF3n que incluye directamente datos controlados por\
    \ el usuario (por ejemplo, desde req.body) dentro de c\xF3digo PHP. Si un atacante\
    \ puede inyectar comillas o c\xF3digo PHP en estos valores, el archivo resultante\
    \ ser\xE1 interpretado por el int\xE9rprete PHP, permitiendo ejecuci\xF3n remota\
    \ de c\xF3digo. Valida y escapa estrictamente cualquier dato antes de escribirlo\
    \ en archivos PHP que luego ser\xE1n incluidos o ejecutados por el servidor.\n"
  patterns:
  - pattern-inside: 'fs.writeFile($CONFIG_PATH, $CONTENT, ...)

      '
  - pattern: "`<?php\n$... = $...(\n  $... => '${...}',\n  ...\n);\n?>`\n"
  - pattern-inside: "const $CONTENT = `<?php\n$... = $...(\n  $... => '${...}',\n\
      \  ...\n);\n?>`;\n"
  - pattern-either:
    - pattern: "const $REQ = require('express');\n...\n$APP.$METHOD(..., (req, res,\
        \ ...) => {\n  ...\n  $VAR = req.body.$FIELD || $DEFAULT;\n  ...\n});\n"
    - pattern: "$APP.$METHOD(..., (req, res, ...) => {\n  ...\n  $VAR = req.body.$FIELD\
        \ || $DEFAULT;\n  ...\n});\n"
  metadata:
    cwe: 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
    owasp: A03:2021 - Injection
    category: security
    technology:
    - javascript
    - typescript
    - nodejs
    likelihood: HIGH
    impact: HIGH
    confidence: MEDIUM
    references:
    - https://nvd.nist.gov/vuln/detail/CVE-2009-1151
