rules:
- id: synthetic-cve20201956
  languages:
  - javascript
  - typescript
  severity: ERROR
  message: "Posible inyecci\xF3n de comandos del sistema operativo (OS Command Injection)\
    \ relacionada con CVE-2020-1956 / APIs tipo \"Kylin-like\". Se est\xE1 construyendo\
    \ un comando de shell con datos controlados por el usuario (por ejemplo, par\xE1\
    metros de una petici\xF3n HTTP) y pas\xE1ndolo a child_process.exec/execSync sin\
    \ sanitizaci\xF3n robusta. Un atacante puede inyectar comandos arbitrarios (por\
    \ ejemplo, `\"; rm -rf /\"`), lo que permite ejecuci\xF3n remota de c\xF3digo\
    \ (RCE) con los privilegios del proceso del servidor.\n"
  metadata:
    cve: CVE-2020-1956
    source: CISA_KEV
    category: security
    technology:
    - nodejs
    - express
    owasp:
    - A01:2021-Broken Access Control
    - A03:2021-Injection
    references:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-1956
    - https://semgrep.dev/docs/writing-rules/pattern-syntax/
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    cwe: 'CWE-78: Improper Neutralization of Special Elements used in an OS Command'
  patterns:
  - pattern-either:
    - pattern: 'const { exec } = require(''child_process'');

        ...

        exec($CMD, ...);

        '
    - pattern: 'const { execSync } = require(''child_process'');

        ...

        execSync($CMD, ...);

        '
    - pattern: 'const child_process = require(''child_process'');

        ...

        child_process.exec($CMD, ...);

        '
    - pattern: 'const child_process = require(''child_process'');

        ...

        child_process.execSync($CMD, ...);

        '
  - pattern-either:
    - pattern: 'const $CMD = $A + $B;

        '
    - pattern: 'let $CMD = $A + $B;

        '
    - pattern: 'var $CMD = $A + $B;

        '
    - pattern: 'const $CMD = `$...${$X}$...`;

        '
    - pattern: 'let $CMD = `$...${$X}$...`;

        '
    - pattern: 'var $CMD = `$...${$X}$...`;

        '
  - pattern-either:
    - pattern: 'const { ..., $V, ... } = req.body;

        '
    - pattern: 'const { ..., $V, ... } = req.query;

        '
    - pattern: 'const { ..., $V, ... } = req.params;

        '
    - pattern: 'let $V = req.body.$FIELD;

        '
    - pattern: 'let $V = req.query.$FIELD;

        '
    - pattern: 'let $V = req.params.$FIELD;

        '
  - pattern: |
      ...
      $V = ...;
      ...
      $CMD = ... + $V + ...;
      ...
      exec($CMD, ...);
  fix: "Evita construir comandos de shell con datos controlados por el usuario. Usa\
    \ APIs seguras como child_process.execFile/execFileSync con argumentos separados,\
    \ valida estrictamente los par\xE1metros permitidos (listas blancas) y/o elimina\
    \ completamente la necesidad de ejecutar comandos del sistema operativo desde\
    \ la ruta HTTP."
